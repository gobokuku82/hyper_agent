# ë¶€ë™ì‚° ì±—ë´‡ ì‹œìŠ¤í…œ ì¢…í•© ë¶„ì„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-01-30
**ë²„ì „**: 2.0
**ë¶„ì„ ëŒ€ìƒ**: HolmesNyangz Beta v0.01 ì±—ë´‡ ì‹œìŠ¤í…œ
**ëª©ì **: ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜, ë°ì´í„° íë¦„, ê¸°ìˆ  ìŠ¤íƒ ì¢…í•© ë¶„ì„
**ë¶„ì„ ë²”ìœ„**: Backend (Python/FastAPI), Frontend (Next.js), Database (PostgreSQL), AI/LLM Integration

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#2-ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ](#3-í•µì‹¬-ê¸°ìˆ -ìŠ¤íƒ)
4. [ê³„ì¸µë³„ ìƒì„¸ ë¶„ì„](#4-ê³„ì¸µë³„-ìƒì„¸-ë¶„ì„)
5. [ë°ì´í„° íë¦„ ë¶„ì„](#5-ë°ì´í„°-íë¦„-ë¶„ì„)
6. [State ê´€ë¦¬ ì²´ê³„](#6-state-ê´€ë¦¬-ì²´ê³„)
7. [Agent ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#7-agent-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
8. [LLM í†µí•© ì „ëµ](#8-llm-í†µí•©-ì „ëµ)
9. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#9-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
10. [WebSocket í†µì‹  íŒ¨í„´](#10-websocket-í†µì‹ -íŒ¨í„´)
11. [ì„¤ê³„ íŒ¨í„´ ë° ì›ì¹™](#11-ì„¤ê³„-íŒ¨í„´-ë°-ì›ì¹™)
12. [í™•ì¥ì„± ë° ì„±ëŠ¥](#12-í™•ì¥ì„±-ë°-ì„±ëŠ¥)
13. [ë³´ì•ˆ ë° ì—ëŸ¬ ì²˜ë¦¬](#13-ë³´ì•ˆ-ë°-ì—ëŸ¬-ì²˜ë¦¬)
14. [ê°œë°œ ë¡œë“œë§µ](#14-ê°œë°œ-ë¡œë“œë§µ)
15. [ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­](#15-ê²°ë¡ -ë°-ê¶Œì¥ì‚¬í•­)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í”„ë¡œì íŠ¸ëª…** | HolmesNyangz (í™ˆì¦ˆëƒ¥ì¦ˆ) |
| **ë²„ì „** | Beta v0.01 |
| **ì‹œìŠ¤í…œ ìœ í˜•** | AI ê¸°ë°˜ ëŒ€í™”í˜• ë¶€ë™ì‚° ìƒë‹´ ì±—ë´‡ |
| **ì£¼ìš” ê¸°ëŠ¥** | ë²•ë¥  ìƒë‹´, ë§¤ë¬¼ ê²€ìƒ‰, ì‹œì„¸ ë¶„ì„, ëŒ€ì¶œ ìƒë‹´, ê³„ì•½ì„œ ìƒì„± |
| **ê°œë°œ ì–¸ì–´** | Python 3.11+, TypeScript |
| **ë°°í¬ í™˜ê²½** | Windows (ê°œë°œ), Linux (ì˜ˆì •) |

### 1.2 ì‹œìŠ¤í…œ ëª©ì 

**HolmesNyangz**ëŠ” ë¶€ë™ì‚° ê±°ë˜ ì „ë°˜ì— ëŒ€í•œ AI ê¸°ë°˜ ìƒë‹´ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ëŒ€í™”í˜• ì±—ë´‡ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**í•µì‹¬ ê°€ì¹˜ ì œì•ˆ**:
1. **ë²•ë¥  ì „ë¬¸ì„±** - ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ë“± ë¶€ë™ì‚° ë²•ë¥  ì •ë³´ ì œê³µ
2. **ì‹œì¥ ì¸ì‚¬ì´íŠ¸** - ì‹¤ì‹œê°„ ì‹œì„¸, ê±°ë˜ ë™í–¥ ë¶„ì„
3. **ë§ì¶¤í˜• ì¶”ì²œ** - ì‚¬ìš©ì ì¡°ê±´ì— ë§ëŠ” ë§¤ë¬¼ ê²€ìƒ‰ ë° ì¶”ì²œ
4. **ìë™í™”ëœ ë¬¸ì„œ ìƒì„±** - ì„ëŒ€ì°¨ ê³„ì•½ì„œ ìë™ ìƒì„±
5. **í†µí•© ìƒë‹´** - ëŒ€ì¶œ, íˆ¬ì ìˆ˜ìµë¥  ê³„ì‚° ë“± ì¢…í•© ìƒë‹´

### 1.3 ì‹œìŠ¤í…œ íŠ¹ì§•

**ê¸°ìˆ ì  íŠ¹ì§•**:
- **Multi-Agent ì•„í‚¤í…ì²˜**: ê²€ìƒ‰, ë¬¸ì„œ, ë¶„ì„ íŒ€ ë…ë¦½ ìš´ì˜
- **LangGraph ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°**: ë³µì¡í•œ ì˜ì‚¬ê²°ì • íë¦„ ê´€ë¦¬
- **ì‹¤ì‹œê°„ WebSocket í†µì‹ **: ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ í”¼ë“œë°±
- **Context-Aware ëŒ€í™”**: ëŒ€í™” íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ë§¥ë½ ì´í•´
- **Hybrid Search**: Vector DB (FAISS) + SQL ê²€ìƒ‰ ê²°í•©
- **HITL (Human-in-the-Loop)**: ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° ì œì–´

**ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¹ì§•**:
- **15ê°œ ì˜ë„ ë¶„ë¥˜**: ì„¸ë°€í•œ ì‚¬ìš©ì ì˜ë„ íŒŒì•…
- **3-Tier Memory**: ë‹¨ê¸°/ì¤‘ê¸°/ì¥ê¸° ë©”ëª¨ë¦¬ ê´€ë¦¬
- **Public API í†µí•©**: ê±´ì¶•ë¬¼ëŒ€ì¥, ê³µê³µë°ì´í„° API í™œìš©
- **í™•ì¥ ê°€ëŠ¥í•œ íˆ´ ì‹œìŠ¤í…œ**: ìƒˆë¡œìš´ ê¸°ëŠ¥ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥

---

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„

### 2.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Next.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Chat UI      â”‚  â”‚ Dashboard    â”‚  â”‚ Settings     â”‚          â”‚
â”‚  â”‚ Component    â”‚  â”‚ Component    â”‚  â”‚ Component    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚ WebSocket                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ ws://backend/api/v1/chat/ws/{session_id}
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend (FastAPI)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  WebSocket API Layer                     â”‚   â”‚
â”‚  â”‚  - chat_api.py: Session management, Message handling    â”‚   â”‚
â”‚  â”‚  - ws_manager.py: Connection pooling                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              TeamBasedSupervisor                         â”‚   â”‚
â”‚  â”‚  - Singleton orchestrator for all agents                â”‚   â”‚
â”‚  â”‚  - LangGraph workflow manager                            â”‚   â”‚
â”‚  â”‚  - Checkpointer for state persistence                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚              â”‚              â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚PlanningAgtâ”‚  â”‚SearchTeamâ”‚  â”‚DocumentTmâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚QueryDecmprâ”‚  â”‚AnalysisTmâ”‚  â”‚           â”‚  â”‚AnalysisTeam  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Tool Layer                             â”‚  â”‚
â”‚  â”‚  - HybridLegalSearch (FAISS + SQLite)                    â”‚  â”‚
â”‚  â”‚  - MarketDataTool (Price analysis)                        â”‚  â”‚
â”‚  â”‚  - RealEstateSearchTool (Property DB)                     â”‚  â”‚
â”‚  â”‚  - LoanDataTool (Loan products)                           â”‚  â”‚
â”‚  â”‚  - BuildingRegistryTool (Public API)                      â”‚  â”‚
â”‚  â”‚  - InfrastructureTool (Public API)                        â”‚  â”‚
â”‚  â”‚  - LeaseContractGenerator (Document generation)           â”‚  â”‚
â”‚  â”‚  - ROICalculatorTool (Investment analysis)                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  LLM Integration Layer                    â”‚  â”‚
â”‚  â”‚  - LLMService: OpenAI client wrapper                      â”‚  â”‚
â”‚  â”‚  - PromptManager: Template management                     â”‚  â”‚
â”‚  â”‚    â”œâ”€ cognitive/ (intent_analysis, agent_selection)       â”‚  â”‚
â”‚  â”‚    â”œâ”€ common/ (response_synthesis)                        â”‚  â”‚
â”‚  â”‚    â””â”€ execution/ (search, document, analysis prompts)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ FAISS Vector â”‚  â”‚ SQLite       â”‚           â”‚
â”‚  â”‚ - chat_sess  â”‚  â”‚ DB (Legal)   â”‚  â”‚ (Decisions)  â”‚           â”‚
â”‚  â”‚ - chat_msg   â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚ - users      â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚ - real_est   â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â”‚ - transactn  â”‚  â”‚              â”‚  â”‚              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ê³„ì¸µ êµ¬ì¡° (Layered Architecture)

ì‹œìŠ¤í…œì€ **7ê°œ ê³„ì¸µ**ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê° ê³„ì¸µì€ ëª…í™•í•œ ì±…ì„ì„ ê°€ì§‘ë‹ˆë‹¤:

| ê³„ì¸µ | ì´ë¦„ | ì—­í•  | ì£¼ìš” ì»´í¬ë„ŒíŠ¸ |
|------|------|------|---------------|
| **Layer 0** | **API Gateway** | WebSocket ì—°ê²° ê´€ë¦¬, ì„¸ì…˜ ê²€ì¦ | chat_api.py, ws_manager.py |
| **Layer 1** | **Orchestration** | ì „ì²´ ì›Œí¬í”Œë¡œìš° ì¡°ì •, State ê´€ë¦¬ | TeamBasedSupervisor |
| **Layer 2** | **Workflow Engine** | LangGraph ê¸°ë°˜ ë…¸ë“œ ì‹¤í–‰ | initialize, planning, execute, aggregate, response |
| **Layer 3** | **Planning** | ì˜ë„ ë¶„ì„, Agent ì„ íƒ, ì‹¤í–‰ ê³„íš | PlanningAgent, QueryDecomposer |
| **Layer 4** | **Agent Selection** | ì ì ˆí•œ íŒ€ ì„ íƒ (Search/Document/Analysis) | Agent Registry |
| **Layer 5** | **Execution** | íŒ€ë³„ ì‘ì—… ì‹¤í–‰ | SearchExecutor, DocumentExecutor, AnalysisExecutor |
| **Layer 6** | **Tool Layer** | ì‹¤ì œ ë°ì´í„° ê²€ìƒ‰, ë¶„ì„, ìƒì„± | 14ê°œ Tool í´ë˜ìŠ¤ |
| **Layer 7** | **Data Access** | ë°ì´í„°ë² ì´ìŠ¤ ë° ì™¸ë¶€ API ì ‘ê·¼ | PostgreSQL, FAISS, Public APIs |

---

## 3. í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

### 3.1 Backend

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|---------|------|------|------|
| **Web Framework** | FastAPI | Latest | REST API, WebSocket ì„œë²„ |
| **AI Framework** | LangGraph | 0.6+ | Agent workflow orchestration |
| **AI Framework** | LangChain | Latest | LLM utilities, tool integration |
| **LLM Provider** | OpenAI | GPT-4 | Natural language understanding |
| **Database** | PostgreSQL | 14+ | User data, chat history, real estate data |
| **Vector DB** | FAISS | Latest | Legal document search |
| **Caching** | SQLite | 3.x | Decision logging |
| **Async** | asyncio | Python 3.11+ | Asynchronous I/O |
| **ORM** | SQLAlchemy | 2.0+ | Database ORM |
| **Data Processing** | pandas | Latest | CSV data manipulation |
| **HTTP Client** | httpx | Latest | External API calls |

### 3.2 Frontend

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|---------|------|------|------|
| **Framework** | Next.js | 14+ (App Router) | React framework |
| **UI Library** | React | 18+ | Component library |
| **Language** | TypeScript | 5.0+ | Type-safe development |
| **Styling** | Tailwind CSS | 3.x | Utility-first CSS |
| **WebSocket** | native WebSocket | - | Real-time communication |
| **State Management** | React Hooks | - | Local state management |

### 3.3 Infrastructure

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  | ìš©ë„ |
|---------|------|------|
| **OS** | Windows (Dev), Linux (Prod) | Development & Deployment |
| **Package Manager** | pip (Backend), npm (Frontend) | Dependency management |
| **Version Control** | Git | Source code management |

### 3.4 External APIs

| API | Provider | ìš©ë„ |
|-----|----------|------|
| **ê±´ì¶•ë¬¼ëŒ€ì¥ API** | ê³µê³µë°ì´í„°í¬í„¸ | ê±´ë¬¼ ì •ë³´ ì¡°íšŒ |
| **ë¶€ë™ì‚° ì‹¤ê±°ë˜ê°€ API** | êµ­í† êµí†µë¶€ | ê±°ë˜ ê°€ê²© ì¡°íšŒ |
| **ì§€ë„ API** | Kakao Maps | ì¢Œí‘œ ë³€í™˜, ì¸í”„ë¼ ê²€ìƒ‰ |

---

## 4. ê³„ì¸µë³„ ìƒì„¸ ë¶„ì„

### 4.1 Layer 0: API Gateway (FastAPI WebSocket)

**íŒŒì¼**: `backend/app/api/chat_api.py`

**í•µì‹¬ ì—­í• **:
- WebSocket ì—°ê²° ìˆ˜ë¦½ ë° ê´€ë¦¬
- ì„¸ì…˜ ê²€ì¦ ë° ì¸ì¦
- ë©”ì‹œì§€ ë¼ìš°íŒ…
- ë¹„ë™ê¸° ì¿¼ë¦¬ ì²˜ë¦¬ Task ìƒì„±

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸**:

```python
# WebSocket ì—°ê²°
@router.websocket("/ws/{session_id}")
async def websocket_chat(
    websocket: WebSocket,
    session_id: str,
    session_mgr: SessionManager = Depends(get_session_manager),
    conn_mgr: ConnectionManager = Depends(get_connection_manager)
)

# ì„¸ì…˜ ê´€ë¦¬ (REST API)
@router.post("/sessions/start", response_model=SessionStartResponse)
async def start_session(request: SessionStartRequest)

@router.get("/sessions/{session_id}", response_model=SessionInfo)
async def get_session(session_id: str)

@router.delete("/sessions/{session_id}", response_model=DeleteSessionResponse)
async def delete_session(session_id: str)
```

**WebSocket ë©”ì‹œì§€ íë¦„**:

1. **ì—°ê²° ìˆ˜ë¦½**
   - í´ë¼ì´ì–¸íŠ¸: `ws://backend/api/v1/chat/ws/{session_id}` ì—°ê²°
   - ì„œë²„: ì„¸ì…˜ ê²€ì¦ â†’ ì—°ê²° ìŠ¹ì¸ â†’ `connected` ë©”ì‹œì§€ ì „ì†¡

2. **ì¿¼ë¦¬ ìˆ˜ì‹ **
   - í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„: `{"type": "query", "query": "..."}`
   - ì„œë²„: ë°±ê·¸ë¼ìš´ë“œ Task ìƒì„± (ë¹„ë™ê¸° ì²˜ë¦¬)

3. **ì§„í–‰ ìƒí™© ì „ì†¡** (ì‹¤ì‹œê°„)
   - ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: `{"type": "supervisor_phase_change", ...}`
   - ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: `{"type": "team_progress", ...}`
   - ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: `{"type": "search_result", ...}`

4. **ìµœì¢… ì‘ë‹µ**
   - ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: `{"type": "final_response", "response": {...}}`

**í•µì‹¬ ì„¤ê³„ ê²°ì •**:
- âœ… **ì‹±ê¸€í†¤ Supervisor**: ëª¨ë“  ì„¸ì…˜ì´ í•˜ë‚˜ì˜ Supervisor ì¸ìŠ¤í„´ìŠ¤ ê³µìœ  (ë©”ëª¨ë¦¬ ì ˆì•½)
- âœ… **ë¹„ë™ê¸° ì²˜ë¦¬**: `asyncio.create_task()`ë¡œ ì¿¼ë¦¬ ì²˜ë¦¬ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
- âœ… **Progress Callback**: ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© í”¼ë“œë°±

### 4.2 Layer 1: Orchestration (TeamBasedSupervisor)

**íŒŒì¼**: `backend/app/service_agent/supervisor/team_supervisor.py`

**í•µì‹¬ ì—­í• **:
- ì „ì²´ Agent ì›Œí¬í”Œë¡œìš° ì¡°ì •
- LangGraph ê·¸ë˜í”„ êµ¬ì„± ë° ì‹¤í–‰
- Checkpointing (ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬)
- Progress Callback ê´€ë¦¬

**Supervisor êµ¬ì¡°**:

```python
class TeamBasedSupervisor:
    def __init__(self, llm_context, enable_checkpointing=True):
        # 1. Agent ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        initialize_agent_system(auto_register=True)

        # 2. Planning Agent ìƒì„±
        self.planning_agent = PlanningAgent(llm_context=llm_context)

        # 3. 3ê°œ íŒ€ ì´ˆê¸°í™”
        self.teams = {
            "search": SearchExecutor(llm_context, progress_callback=None),
            "document": DocumentExecutor(llm_context, progress_callback=None),
            "analysis": AnalysisExecutor(llm_context, progress_callback=None)
        }

        # 4. LangGraph ì›Œí¬í”Œë¡œìš° êµ¬ì„±
        self._build_graph()
```

**íŒ€ë³„ ì±…ì„**:

| íŒ€ | ì±…ì„ | ì‚¬ìš© Tool |
|----|------|-----------|
| **SearchExecutor** | ê²€ìƒ‰ ì‘ì—… (ë²•ë¥ , ì‹œì„¸, ëŒ€ì¶œ, ë§¤ë¬¼) | HybridLegalSearch, MarketDataTool, RealEstateSearchTool, LoanDataTool, BuildingRegistryTool, InfrastructureTool |
| **DocumentExecutor** | ë¬¸ì„œ ìƒì„± ë° ê²€í†  | LeaseContractGenerator, ContractAnalysisTool |
| **AnalysisExecutor** | ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ | MarketAnalysisTool, ROICalculatorTool, PolicyMatcherTool |

### 4.3 Layer 2: Workflow Engine (LangGraph)

**LangGraph ë…¸ë“œ êµ¬ì„±**:

```python
workflow = StateGraph(MainSupervisorState)

# 5ê°œ ë…¸ë“œ
workflow.add_node("initialize", self.initialize_node)
workflow.add_node("planning", self.planning_node)
workflow.add_node("execute_teams", self.execute_teams_node)
workflow.add_node("aggregate", self.aggregate_results_node)
workflow.add_node("generate_response", self.generate_response_node)

# ì—£ì§€ êµ¬ì„±
workflow.add_edge(START, "initialize")
workflow.add_edge("initialize", "planning")

# ì¡°ê±´ë¶€ ë¼ìš°íŒ…
workflow.add_conditional_edges(
    "planning",
    self._route_after_planning,
    {"execute": "execute_teams", "respond": "generate_response"}
)

workflow.add_edge("execute_teams", "aggregate")
workflow.add_edge("aggregate", "generate_response")
workflow.add_edge("generate_response", END)
```

**ë…¸ë“œë³„ ì²˜ë¦¬ íë¦„**:

```
START
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  initialize      â”‚  1. State ì´ˆê¸°í™”
â”‚  [5% progress]   â”‚  2. WebSocket ì•Œë¦¼: "ì§ˆë¬¸ ì ‘ìˆ˜ ì¤‘"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  planning        â”‚  1. Chat History ì¡°íšŒ (ìµœê·¼ 3ìŒ)
â”‚  [10% progress]  â”‚  2. Intent ë¶„ì„ (LLM ë˜ëŠ” íŒ¨í„´ ë§¤ì¹­)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  3. Agent ì„ íƒ (4ë‹¨ê³„ í´ë°±)
         â†“            4. ì‹¤í–‰ ê³„íš ìƒì„±
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Router â”‚ â† IRRELEVANT/UNCLEAR? â†’ generate_response (ë°”ë¡œ ì‘ë‹µ)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   execution_steps ìˆìŒ? â†’ execute_teams
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ execute_teams    â”‚  1. íŒ€ë³„ ë³‘ë ¬ ì‹¤í–‰
â”‚ [20-80% progress]â”‚  2. SearchExecutor: ë²•ë¥ /ì‹œì„¸/ëŒ€ì¶œ ê²€ìƒ‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  3. DocumentExecutor: ê³„ì•½ì„œ ìƒì„±
         â†“            4. AnalysisExecutor: ë°ì´í„° ë¶„ì„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  aggregate       â”‚  1. íŒ€ë³„ ê²°ê³¼ ì§‘ê³„
â”‚  [85% progress]  â”‚  2. ì¤‘ë³µ ì œê±°, ìš°ì„ ìˆœìœ„ ì •ë ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  3. êµ¬ì¡°í™”ëœ ë°ì´í„° ìƒì„±
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚generate_response â”‚  1. LLMìœ¼ë¡œ ìµœì¢… ë‹µë³€ ìƒì„±
â”‚  [95% progress]  â”‚  2. structured_data ìƒì„± (sections, metadata)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  3. WebSocket ì „ì†¡
         â†“
       END
```

### 4.4 Layer 3: Planning (PlanningAgent)

**íŒŒì¼**: `backend/app/service_agent/cognitive_agents/planning_agent.py`

**í•µì‹¬ ì—­í• **:
- ì‚¬ìš©ì ì˜ë„ ë¶„ì„ (15ê°œ ì¹´í…Œê³ ë¦¬)
- Agent ì„ íƒ (4ë‹¨ê³„ í´ë°± ë©”ì»¤ë‹ˆì¦˜)
- ì‹¤í–‰ ê³„íš ìƒì„±
- Query Decomposition (ë³µì¡í•œ ì§ˆë¬¸ ë¶„í•´)

**15ê°œ ì˜ë„ ë¶„ë¥˜ (IntentType)**:

| IntentType | ì„¤ëª… | ì˜ˆì‹œ ì§ˆë¬¸ | ì„ íƒë˜ëŠ” íŒ€ |
|-----------|------|-----------|-------------|
| **TERM_DEFINITION** | ìš©ì–´ ì„¤ëª… | "LTVê°€ ë­ì•¼?" | search_team |
| **LEGAL_INQUIRY** | ë²•ë¥  í•´ì„ | "ì „ì„¸ê¸ˆ ì¸ìƒ í•œë„ëŠ”?" | search_team |
| **LOAN_SEARCH** | ëŒ€ì¶œ ìƒí’ˆ ê²€ìƒ‰ | "ì²­ë…„ ì „ì„¸ìê¸ˆëŒ€ì¶œì€?" | search_team |
| **LOAN_COMPARISON** | ëŒ€ì¶œ ì¡°ê±´ ë¹„êµ | "ì€í–‰ë³„ ê¸ˆë¦¬ ë¹„êµ" | search_team |
| **BUILDING_REGISTRY** | ê±´ì¶•ë¬¼ëŒ€ì¥ ì¡°íšŒ | "ê±´ë¬¼ ì •ë³´ ì¡°íšŒ" | search_team |
| **PROPERTY_INFRA_ANALYSIS** | ì¸í”„ë¼ ë¶„ì„ | "ì£¼ë³€ ì´ˆë“±í•™êµëŠ”?" | search_team |
| **PRICE_EVALUATION** | ê°€ê²© í‰ê°€ | "ì´ ë§¤ë¬¼ ì ì •ê°€ì•¼?" | analysis_team |
| **PROPERTY_SEARCH** | ë§¤ë¬¼ ê²€ìƒ‰ | "ê°•ë‚¨ 3ì–µ ì•„íŒŒíŠ¸ ì°¾ì•„ì¤˜" | search_team |
| **PROPERTY_RECOMMENDATION** | ë§ì¶¤ ì¶”ì²œ | "ì‹ í˜¼ë¶€ë¶€ ì¶”ì²œ ë§¤ë¬¼" | search_team + analysis_team |
| **ROI_CALCULATION** | íˆ¬ì ìˆ˜ìµë¥  ê³„ì‚° | "ì›”ì„¸ ìˆ˜ìµë¥  ê³„ì‚°" | analysis_team |
| **POLICY_INQUIRY** | ì •ë¶€ ì •ì±… ì¡°íšŒ | "ìƒì• ìµœì´ˆ íŠ¹ë³„ê³µê¸‰ì€?" | search_team |
| **CONTRACT_CREATION** | ê³„ì•½ì„œ ìƒì„± | "ì„ëŒ€ì°¨ ê³„ì•½ì„œ ë§Œë“¤ì–´ì¤˜" | document_team |
| **MARKET_INQUIRY** | ì‹œì„¸ íŠ¸ë Œë“œ ë¶„ì„ | "ê°•ë‚¨ ì‹œì„¸ ì¶”ì´ëŠ”?" | search_team + analysis_team |
| **COMPREHENSIVE** | ì¢…í•© ë¶„ì„ | "ë§¤ë¬¼ ì¢…í•© ë¶„ì„í•´ì¤˜" | search_team + analysis_team |
| **IRRELEVANT** | ë¬´ê´€í•œ ì§ˆë¬¸ | "ë‚ ì”¨ ì–´ë•Œ?" | (ì‘ë‹µ ì¦‰ì‹œ ë°˜í™˜) |

**Intent ë¶„ì„ í”„ë¡œì„¸ìŠ¤**:

```python
# 1ì°¨ ì‹œë„: LLM ê¸°ë°˜ ë¶„ì„
async def analyze_intent(self, query, context):
    if self.llm_service:
        try:
            return await self._analyze_with_llm(query, context)
        except Exception as e:
            logger.warning(f"LLM analysis failed: {e}")

    # 2ì°¨ ì‹œë„: íŒ¨í„´ ë§¤ì¹­ (Fallback)
    return self._analyze_with_patterns(query, context)
```

**LLM ê¸°ë°˜ ë¶„ì„**:
- í”„ë¡¬í”„íŠ¸: `prompts/cognitive/intent_analysis.txt`
- ì…ë ¥: ì‚¬ìš©ì ì¿¼ë¦¬ + Chat History (ìµœê·¼ 3ìŒ)
- ì¶œë ¥: JSON í˜•ì‹ (`intent`, `confidence`, `keywords`, `entities`, `reasoning`)

**Agent ì„ íƒ (4ë‹¨ê³„ í´ë°±)**:

```python
async def _suggest_agents(self, intent_type, query, keywords):
    # 0ë‹¨ê³„: í•˜ë“œì½”ë”© í‚¤ì›Œë“œ í•„í„°
    if any(kw in query for kw in ["ê³„ì•½ì„œ", "ì‘ì„±", "ë§Œë“¤ì–´"]):
        return ["document_team"]

    # 1ë‹¨ê³„: LLM Agent ì„ íƒ
    try:
        result = await self.llm_service.complete_json_async(
            prompt_name="agent_selection",
            variables={"query": query, "intent": intent_type.value}
        )
        return result.get("selected_agents", [])
    except:
        pass

    # 2ë‹¨ê³„: Simplified LLM
    try:
        simple_result = await self.llm_service.complete_async(...)
        # í…ìŠ¤íŠ¸ íŒŒì‹±
    except:
        pass

    # 3ë‹¨ê³„: Safe Defaults (Intent â†’ Agent ë§¤í•‘)
    return self._get_default_agents_for_intent(intent_type)
```

**Query Decomposer** (Phase 1 Enhancement):

ë³µì¡í•œ ì§ˆë¬¸ì„ ì—¬ëŸ¬ ì„œë¸Œì¿¼ë¦¬ë¡œ ë¶„í•´:

```python
# ì˜ˆì‹œ ì…ë ¥
"ê°•ë‚¨ ì•„íŒŒíŠ¸ ë§¤ë¬¼ ì¤‘ ì´ˆë“±í•™êµ ë„ë³´ 10ë¶„ ì´ë‚´ì´ê³  íˆ¬ì ìˆ˜ìµë¥  ì¢‹ì€ ê³³ ì¶”ì²œí•´ì¤˜"

# ë¶„í•´ ê²°ê³¼
sub_queries = [
    {"query": "ê°•ë‚¨ ì•„íŒŒíŠ¸ ë§¤ë¬¼ ê²€ìƒ‰", "team": "search"},
    {"query": "ì´ˆë“±í•™êµ ì¸í”„ë¼ ë¶„ì„", "team": "search"},
    {"query": "íˆ¬ì ìˆ˜ìµë¥  ê³„ì‚°", "team": "analysis"}
]
```

### 4.5 Layer 5: Execution (Executors)

#### 4.5.1 SearchExecutor

**íŒŒì¼**: `backend/app/service_agent/execution_agents/search_executor.py`

**ì±…ì„**: ê²€ìƒ‰ ì‘ì—… ì‹¤í–‰ (ë²•ë¥ , ì‹œì„¸, ëŒ€ì¶œ, ë§¤ë¬¼, ì¸í”„ë¼)

**ì‚¬ìš© Tool**:

1. **HybridLegalSearch** - ë²•ë¥  ì •ë³´ ê²€ìƒ‰
   - FAISS Vector DB (ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰)
   - SQLite (í‚¤ì›Œë“œ ê²€ìƒ‰)
   - í•˜ì´ë¸Œë¦¬ë“œ ê²°ê³¼ ë³‘í•©

2. **MarketDataTool** - ì‹œì„¸ ì •ë³´ ì¡°íšŒ
   - í‰ê· /ìµœê³ /ìµœì € ê°€ê²© ê³„ì‚°
   - ê±°ë˜ ë™í–¥ ë¶„ì„

3. **RealEstateSearchTool** - ë§¤ë¬¼ ê²€ìƒ‰
   - PostgreSQL `real_estates` í…Œì´ë¸” ì¿¼ë¦¬
   - ê°€ê²©, ìœ„ì¹˜, ë©´ì  í•„í„°ë§

4. **LoanDataTool** - ëŒ€ì¶œ ìƒí’ˆ ì •ë³´
   - ì€í–‰ë³„ ëŒ€ì¶œ ìƒí’ˆ ë°ì´í„°
   - ê¸ˆë¦¬, í•œë„, ì¡°ê±´ ë¹„êµ

5. **BuildingRegistryTool** - ê±´ì¶•ë¬¼ ëŒ€ì¥ ì¡°íšŒ
   - ê³µê³µë°ì´í„° API í˜¸ì¶œ
   - ê±´ë¬¼ ì •ë³´ (ì¤€ê³µì¼, ìš©ë„, ë©´ì  ë“±)

6. **InfrastructureTool** - ì£¼ë³€ ì¸í”„ë¼ ê²€ìƒ‰
   - Kakao ì§€ë„ API
   - í•™êµ, ë³‘ì›, ì§€í•˜ì² ì—­ ë“± ê±°ë¦¬ ê³„ì‚°

**ì‹¤í–‰ ì „ëµ**:
- **ë³‘ë ¬ ì‹¤í–‰**: ë…ë¦½ì ì¸ ê²€ìƒ‰ ì‘ì—… ë™ì‹œ ìˆ˜í–‰
- **ìˆœì°¨ ì‹¤í–‰**: ì˜ì¡´ì„± ìˆëŠ” ì‘ì—… ìˆœì„œ ë³´ì¥
- **ì—ëŸ¬ ì²˜ë¦¬**: ê°œë³„ ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ë‹¤ë¥¸ ê²€ìƒ‰ ê³„ì† ì§„í–‰

#### 4.5.2 DocumentExecutor

**íŒŒì¼**: `backend/app/service_agent/execution_agents/document_executor.py`

**ì±…ì„**: ë¬¸ì„œ ìƒì„± ë° ê²€í† 

**HITL (Human-in-the-Loop) ì§€ì›**:
- LangGraph 0.6ì˜ Interrupt ê¸°ëŠ¥ í™œìš©
- ì‚¬ìš©ì í™•ì¸ì´ í•„ìš”í•œ ì‹œì ì— ì›Œí¬í”Œë¡œìš° ì¤‘ë‹¨
- ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜ í›„ ì¬ê°œ

**ì‚¬ìš© Tool**:

1. **LeaseContractGenerator** - ì„ëŒ€ì°¨ ê³„ì•½ì„œ ìƒì„±
   - í…œí”Œë¦¿ ê¸°ë°˜ ë¬¸ì„œ ìƒì„±
   - ì‚¬ìš©ì ì…ë ¥ ë°ì´í„° ìë™ ì±„ìš°ê¸°

2. **ContractAnalysisTool** - ê³„ì•½ì„œ ê²€í† 
   - ë²•ë¥  ë¦¬ìŠ¤í¬ ë¶„ì„
   - ê¶Œì¥ì‚¬í•­ ì œì‹œ

**ë¬¸ì„œ ìƒì„± íë¦„**:

```
1. ë¬¸ì„œ íƒ€ì… í™•ì¸ (lease_contract, sales_contract, etc.)
2. í…œí”Œë¦¿ ë¡œë“œ
3. ì‚¬ìš©ì ë°ì´í„° ìˆ˜ì§‘
4. [INTERRUPT] ì‚¬ìš©ì í™•ì¸ ìš”ì²­ â† HITL
5. ì‚¬ìš©ì ìŠ¹ì¸ í›„ ë¬¸ì„œ ìƒì„±
6. [INTERRUPT] ìƒì„±ëœ ë¬¸ì„œ í™•ì¸ â† HITL
7. ìµœì¢… ë¬¸ì„œ ë°˜í™˜
```

#### 4.5.3 AnalysisExecutor

**íŒŒì¼**: `backend/app/service_agent/execution_agents/analysis_executor.py`

**ì±…ì„**: ë°ì´í„° ë¶„ì„ ë° ì¸ì‚¬ì´íŠ¸ ìƒì„±

**ì‚¬ìš© Tool**:

1. **MarketAnalysisTool** - ì‹œì¥ ë¶„ì„
   - ê°€ê²© íŠ¸ë Œë“œ ë¶„ì„
   - ê±°ë˜ëŸ‰ ë³€í™” ì¶”ì´
   - ì§€ì—­ë³„ ë¹„êµ

2. **ROICalculatorTool** - íˆ¬ì ìˆ˜ìµë¥  ê³„ì‚°
   - ì›”ì„¸ ìˆ˜ìµë¥ 
   - ì „ì„¸ ì‹œì„¸ì°¨ìµ
   - ë§¤ë§¤ ìˆ˜ìµë¥ 

3. **PolicyMatcherTool** - ì •ì±… ë§¤ì¹­
   - ì‚¬ìš©ì ì¡°ê±´ì— ë§ëŠ” ì •ë¶€ ì •ì±… ì°¾ê¸°
   - íŠ¹ë³„ê³µê¸‰ ìê²© í™•ì¸

---

## 5. ë°ì´í„° íë¦„ ë¶„ì„

### 5.1 ì „ì²´ ë°ì´í„° íë¦„

ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ë¶€í„° ìµœì¢… ë‹µë³€ê¹Œì§€ì˜ ì™„ì „í•œ ë°ì´í„° íë¦„:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‚¬ìš©ì ì…ë ¥                                                   â”‚
â”‚    "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. WebSocket ë©”ì‹œì§€ ì „ì†¡                                         â”‚
â”‚    {                                                             â”‚
â”‚      "type": "query",                                            â”‚
â”‚      "query": "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?",                      â”‚
â”‚      "enable_checkpointing": true                                â”‚
â”‚    }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. FastAPI WebSocket ìˆ˜ì‹                                         â”‚
â”‚    - session_id ê²€ì¦                                             â”‚
â”‚    - DB ì €ì¥: chat_messages (role=user)                          â”‚
â”‚    - asyncio.create_task() ìƒì„±                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Supervisor í˜¸ì¶œ                                               â”‚
â”‚    result = await supervisor.process_query_streaming(...)       â”‚
â”‚                                                                  â”‚
â”‚    ì´ˆê¸° State ìƒì„±:                                              â”‚
â”‚    MainSupervisorState = {                                       â”‚
â”‚      query: "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?",                        â”‚
â”‚      session_id: "session-9b050480-...",                         â”‚
â”‚      current_phase: "",                                          â”‚
â”‚      planning_state: None,                                       â”‚
â”‚      team_results: {},                                           â”‚
â”‚      ...                                                         â”‚
â”‚    }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. LangGraph ì‹¤í–‰                                                â”‚
â”‚    final_state = await app.ainvoke(initial_state, config)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. initialize_node                                               â”‚
â”‚    State ì—…ë°ì´íŠ¸:                                               â”‚
â”‚    - current_phase = "initialization"                            â”‚
â”‚    - status = "initialized"                                      â”‚
â”‚    - active_teams = []                                           â”‚
â”‚    - team_results = {}                                           â”‚
â”‚                                                                  â”‚
â”‚    WebSocket ì „ì†¡:                                               â”‚
â”‚    {"type": "supervisor_phase_change",                           â”‚
â”‚     "supervisorPhase": "dispatching",                            â”‚
â”‚     "supervisorProgress": 5}                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. planning_node                                                 â”‚
â”‚    7-1. Chat History ì¡°íšŒ (ìµœê·¼ 3ìŒ, PostgreSQL)                 â”‚
â”‚         chat_history = [                                         â”‚
â”‚           {"role": "user", "content": "...", "timestamp": "..."},â”‚
â”‚           {"role": "assistant", "content": "...", ...}           â”‚
â”‚         ]                                                        â”‚
â”‚                                                                  â”‚
â”‚    7-2. Intent ë¶„ì„ (LLM í˜¸ì¶œ)                                   â”‚
â”‚         LLMService.complete_json_async(                          â”‚
â”‚           prompt_name="intent_analysis",                         â”‚
â”‚           variables={                                            â”‚
â”‚             "query": "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?",               â”‚
â”‚             "chat_history": "..."                                â”‚
â”‚           }                                                      â”‚
â”‚         )                                                        â”‚
â”‚         â†“                                                        â”‚
â”‚         result = {                                               â”‚
â”‚           "intent": "LEGAL_INQUIRY",                             â”‚
â”‚           "confidence": 0.95,                                    â”‚
â”‚           "keywords": ["ì „ì„¸ê¸ˆ", "ì¸ìƒ", "5%"],                  â”‚
â”‚           "reasoning": "ë²•ë¥  ê´€ë ¨ ì§ˆë¬¸ì…ë‹ˆë‹¤.",                  â”‚
â”‚           "entities": {"rate": "5%"}                             â”‚
â”‚         }                                                        â”‚
â”‚                                                                  â”‚
â”‚    7-3. Agent ì„ íƒ (4ë‹¨ê³„ í´ë°±)                                  â”‚
â”‚         suggested_agents = ["search_team"]                       â”‚
â”‚                                                                  â”‚
â”‚    7-4. ì‹¤í–‰ ê³„íš ìƒì„±                                           â”‚
â”‚         execution_steps = [                                      â”‚
â”‚           {                                                      â”‚
â”‚             "step_id": "step_0",                                 â”‚
â”‚             "step_type": "search",                               â”‚
â”‚             "agent_name": "search_team",                         â”‚
â”‚             "task": "ë²•ë¥  ì •ë³´ ê²€ìƒ‰",                            â”‚
â”‚             "status": "pending",                                 â”‚
â”‚             ...                                                  â”‚
â”‚           }                                                      â”‚
â”‚         ]                                                        â”‚
â”‚                                                                  â”‚
â”‚    State ì—…ë°ì´íŠ¸:                                               â”‚
â”‚    - planning_state = {                                          â”‚
â”‚        analyzed_intent: {...},                                   â”‚
â”‚        execution_steps: [...]                                    â”‚
â”‚      }                                                           â”‚
â”‚    - active_teams = ["search"]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. _route_after_planning                                         â”‚
â”‚    - intent_type != "irrelevant" âœ…                              â”‚
â”‚    - execution_steps ì¡´ì¬ âœ…                                     â”‚
â”‚    â†’ return "execute" (execute_teams_nodeë¡œ ì´ë™)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. execute_teams_node                                            â”‚
â”‚    9-1. SearchExecutor ì‹¤í–‰                                      â”‚
â”‚         search_result = await search_executor.execute({          â”‚
â”‚           "query": "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?",                 â”‚
â”‚           "keywords": {"legal": ["ì „ì„¸ê¸ˆ", "ì¸ìƒ"]}              â”‚
â”‚         })                                                       â”‚
â”‚                                                                  â”‚
â”‚    9-2. HybridLegalSearch í˜¸ì¶œ                                   â”‚
â”‚         - FAISS Vector DB ê²€ìƒ‰ (ì˜ë¯¸ ê¸°ë°˜)                       â”‚
â”‚           query_embedding = embed("ì „ì„¸ê¸ˆ 5% ì¸ìƒ")              â”‚
â”‚           similar_docs = faiss.search(query_embedding, top_k=5)  â”‚
â”‚           â†’ ["ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°", ...]                       â”‚
â”‚                                                                  â”‚
â”‚         - SQLite í‚¤ì›Œë“œ ê²€ìƒ‰                                     â”‚
â”‚           keyword_results = search("ì „ì„¸ê¸ˆ ì¸ìƒ", top_k=5)       â”‚
â”‚           â†’ [ë²•ë¥  ì¡°í•­ë“¤...]                                     â”‚
â”‚                                                                  â”‚
â”‚         - ê²°ê³¼ ë³‘í•© (ì¤‘ë³µ ì œê±°, ì ìˆ˜ ê¸°ë°˜ ì •ë ¬)                  â”‚
â”‚           merged_results = [                                     â”‚
â”‚             {                                                    â”‚
â”‚               "law_name": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²•",                    â”‚
â”‚               "article": "ì œ7ì¡°",                                â”‚
â”‚               "content": "ì„ëŒ€ë£Œ ì¦ì•¡ì€ 5% ì´ë‚´...",             â”‚
â”‚               "score": 0.95                                      â”‚
â”‚             },                                                   â”‚
â”‚             ...                                                  â”‚
â”‚           ]                                                      â”‚
â”‚                                                                  â”‚
â”‚    State ì—…ë°ì´íŠ¸:                                               â”‚
â”‚    - team_results["search"] = {                                  â”‚
â”‚        "legal_results": merged_results,                          â”‚
â”‚        "total_results": 5,                                       â”‚
â”‚        "search_time": 1.2                                        â”‚
â”‚      }                                                           â”‚
â”‚    - completed_teams = ["search"]                                â”‚
â”‚                                                                  â”‚
â”‚    WebSocket ì „ì†¡:                                               â”‚
â”‚    {"type": "team_progress",                                     â”‚
â”‚     "team": "search",                                            â”‚
â”‚     "progress": 50}                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. aggregate_results_node                                       â”‚
â”‚     - íŒ€ë³„ ê²°ê³¼ ì§‘ê³„                                             â”‚
â”‚     - ì¤‘ë³µ ì œê±°, ìš°ì„ ìˆœìœ„ ì •ë ¬                                   â”‚
â”‚     - êµ¬ì¡°í™”ëœ ë°ì´í„° ìƒì„±                                       â”‚
â”‚                                                                  â”‚
â”‚     aggregated_results = {                                       â”‚
â”‚       "legal_info": [                                            â”‚
â”‚         {                                                        â”‚
â”‚           "source": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°",                    â”‚
â”‚           "content": "ì„ëŒ€ë£Œ ì¦ì•¡ì€ 5% ì´ë‚´ë¡œ ì œí•œ...",          â”‚
â”‚           "relevance": 0.95                                      â”‚
â”‚         }                                                        â”‚
â”‚       ],                                                         â”‚
â”‚       "summary": {                                               â”‚
â”‚         "total_sources": 5,                                      â”‚
â”‚         "highest_relevance": 0.95,                               â”‚
â”‚         "categories": ["ë²•ë¥ "]                                   â”‚
â”‚       }                                                          â”‚
â”‚     }                                                            â”‚
â”‚                                                                  â”‚
â”‚     State ì—…ë°ì´íŠ¸:                                              â”‚
â”‚     - aggregated_results = aggregated_results                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. generate_response_node                                       â”‚
â”‚     11-1. LLMìœ¼ë¡œ ìµœì¢… ë‹µë³€ ìƒì„±                                 â”‚
â”‚           LLMService.complete_async(                             â”‚
â”‚             prompt_name="response_synthesis",                    â”‚
â”‚             variables={                                          â”‚
â”‚               "query": "ì „ì„¸ê¸ˆ 5% ì¸ìƒ ê°€ëŠ¥í•œê°€ìš”?",             â”‚
â”‚               "search_results": aggregated_results,              â”‚
â”‚               "chat_history": chat_history                       â”‚
â”‚             }                                                    â”‚
â”‚           )                                                      â”‚
â”‚           â†“                                                      â”‚
â”‚           answer = """                                           â”‚
â”‚           ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°ì— ë”°ë¥´ë©´, ì „ì„¸ê¸ˆ ì¦ì•¡ì€         â”‚
â”‚           ì—° 5% ì´ë‚´ë¡œ ì œí•œë©ë‹ˆë‹¤. ë”°ë¼ì„œ í˜„ì¬ ì „ì„¸ê¸ˆì˜          â”‚
â”‚           5%ê¹Œì§€ ì¸ìƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.                              â”‚
â”‚           """                                                    â”‚
â”‚                                                                  â”‚
â”‚     11-2. structured_data ìƒì„± (Frontend UIìš©)                  â”‚
â”‚           structured_data = {                                    â”‚
â”‚             "sections": [                                        â”‚
â”‚               {                                                  â”‚
â”‚                 "title": "í•µì‹¬ ë‹µë³€",                            â”‚
â”‚                 "content": "ì „ì„¸ê¸ˆ ì¦ì•¡ì€ 5% ì´ë‚´ë¡œ ì œí•œë©ë‹ˆë‹¤.",â”‚
â”‚                 "icon": "target"                                 â”‚
â”‚               },                                                 â”‚
â”‚               {                                                  â”‚
â”‚                 "title": "ë²•ë¥  ê·¼ê±°",                            â”‚
â”‚                 "content": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°",             â”‚
â”‚                 "icon": "law"                                    â”‚
â”‚               }                                                  â”‚
â”‚             ],                                                   â”‚
â”‚             "metadata": {                                        â”‚
â”‚               "sources": ["ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²•"],                   â”‚
â”‚               "confidence": 0.95                                 â”‚
â”‚             }                                                    â”‚
â”‚           }                                                      â”‚
â”‚                                                                  â”‚
â”‚     State ì—…ë°ì´íŠ¸:                                              â”‚
â”‚     - final_response = {                                         â”‚
â”‚         "type": "answer",                                        â”‚
â”‚         "answer": answer,                                        â”‚
â”‚         "structured_data": structured_data                       â”‚
â”‚       }                                                          â”‚
â”‚     - status = "completed"                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. LangGraph ì¢…ë£Œ                                               â”‚
â”‚     final_state ë°˜í™˜                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. _process_query_async ì™„ë£Œ                                    â”‚
â”‚     13-1. DB ì €ì¥: chat_messages (role=assistant)               â”‚
â”‚           - content = answer                                     â”‚
â”‚           - structured_data = structured_data                    â”‚
â”‚                                                                  â”‚
â”‚     13-2. WebSocket ìµœì¢… ì‘ë‹µ ì „ì†¡                               â”‚
â”‚           {                                                      â”‚
â”‚             "type": "final_response",                            â”‚
â”‚             "response": {                                        â”‚
â”‚               "type": "answer",                                  â”‚
â”‚               "answer": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°ì— ë”°ë¥´ë©´...",    â”‚
â”‚               "structured_data": {...}                           â”‚
â”‚             },                                                   â”‚
â”‚             "timestamp": "2025-01-27T10:30:05.123Z"              â”‚
â”‚           }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. Frontend ìˆ˜ì‹  ë° ë Œë”ë§                                      â”‚
â”‚     - Chat UIì— ë‹µë³€ í‘œì‹œ                                        â”‚
â”‚     - structured_dataë¡œ ì„¹ì…˜ë³„ UI ë Œë”ë§                         â”‚
â”‚     - ì†ŒìŠ¤ ë§í¬ í‘œì‹œ                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ì‹¤ì‹œê°„ Progress ì—…ë°ì´íŠ¸

ì „ì²´ í”„ë¡œì„¸ìŠ¤ ë™ì•ˆ WebSocketì„ í†µí•´ ì‹¤ì‹œê°„ ì§„í–‰ ìƒí™© ì „ì†¡:

| ì§„í–‰ë¥  | Phase | ë©”ì‹œì§€ ì˜ˆì‹œ |
|--------|-------|-------------|
| **5%** | Initialize | "ì§ˆë¬¸ì„ ì ‘ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **10%** | Planning | "ì§ˆë¬¸ì„ ë¶„ì„í•˜ê³  ê³„íšì„ ìˆ˜ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **20%** | Executing | "ë²•ë¥  ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **50%** | Executing | "ê²€ìƒ‰ ì™„ë£Œ, ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **85%** | Aggregating | "ê²°ê³¼ë¥¼ ì •ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **95%** | Generating | "ë‹µë³€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤" |
| **100%** | Completed | "ë‹µë³€ ì™„ë£Œ" |

---

## 6. State ê´€ë¦¬ ì²´ê³„

### 6.1 State ê³„ì¸µ êµ¬ì¡°

```
MainSupervisorState (ìµœìƒìœ„)
â”œâ”€ query: str                    # ì‚¬ìš©ì ì¿¼ë¦¬
â”œâ”€ session_id: str               # WebSocket ì„¸ì…˜ ID
â”œâ”€ chat_session_id: str          # Chat History ì„¸ì…˜ ID
â”œâ”€ user_id: int                  # ì‚¬ìš©ì ID
â”œâ”€ current_phase: str            # í˜„ì¬ ë‹¨ê³„
â”œâ”€ status: str                   # ì „ì²´ ìƒíƒœ
â”‚
â”œâ”€ planning_state: PlanningState # ê³„íš State
â”‚   â”œâ”€ raw_query: str
â”‚   â”œâ”€ analyzed_intent: Dict     # Intent ë¶„ì„ ê²°ê³¼
â”‚   â”œâ”€ execution_steps: List[ExecutionStepState]
â”‚   â”œâ”€ execution_strategy: str   # "sequential" | "parallel"
â”‚   â””â”€ estimated_total_time: float
â”‚
â”œâ”€ search_team_state: SearchTeamState  # ê²€ìƒ‰ íŒ€ State
â”‚   â”œâ”€ team_name: "search"
â”‚   â”œâ”€ status: str
â”‚   â”œâ”€ keywords: SearchKeywords
â”‚   â”‚   â”œâ”€ legal: List[str]
â”‚   â”‚   â”œâ”€ real_estate: List[str]
â”‚   â”‚   â”œâ”€ loan: List[str]
â”‚   â”‚   â””â”€ general: List[str]
â”‚   â”œâ”€ legal_results: List[Dict]
â”‚   â”œâ”€ real_estate_results: List[Dict]
â”‚   â”œâ”€ loan_results: List[Dict]
â”‚   â”œâ”€ property_search_results: List[Dict]
â”‚   â”œâ”€ infrastructure_results: Dict
â”‚   â”œâ”€ building_registry_results: List[Dict]
â”‚   â””â”€ aggregated_results: Dict
â”‚
â”œâ”€ document_team_state: DocumentTeamState  # ë¬¸ì„œ íŒ€ State
â”‚   â”œâ”€ team_name: "document"
â”‚   â”œâ”€ document_type: str
â”‚   â”œâ”€ template: DocumentTemplate
â”‚   â”œâ”€ document_content: DocumentContent
â”‚   â”œâ”€ review_result: ReviewResult
â”‚   â””â”€ final_document: str
â”‚
â”œâ”€ analysis_team_state: AnalysisTeamState  # ë¶„ì„ íŒ€ State
â”‚   â”œâ”€ team_name: "analysis"
â”‚   â”œâ”€ analysis_type: str
â”‚   â”œâ”€ input_data: Dict
â”‚   â”œâ”€ metrics: Dict[str, float]
â”‚   â”œâ”€ insights: List[str]
â”‚   â”œâ”€ report: Dict
â”‚   â””â”€ recommendations: List[str]
â”‚
â”œâ”€ team_results: Dict[str, Any]  # íŒ€ë³„ ì‹¤í–‰ ê²°ê³¼
â”‚   â”œâ”€ search: Dict
â”‚   â”œâ”€ document: Dict
â”‚   â””â”€ analysis: Dict
â”‚
â”œâ”€ aggregated_results: Dict      # ì§‘ê³„ëœ ê²°ê³¼
â”‚
â””â”€ final_response: Dict          # ìµœì¢… ì‘ë‹µ
    â”œâ”€ type: "answer"
    â”œâ”€ answer: str
    â””â”€ structured_data: Dict
```

### 6.2 State ì „íŒŒ ë©”ì»¤ë‹ˆì¦˜

**LangGraph State ì—…ë°ì´íŠ¸ íŒ¨í„´**:

```python
# ê° ë…¸ë“œì—ì„œ State ìˆ˜ì •
async def some_node(self, state: MainSupervisorState) -> MainSupervisorState:
    # State ì½ê¸°
    query = state["query"]

    # State ìˆ˜ì •
    state["current_phase"] = "processing"
    state["team_results"]["search"] = {...}

    # ìˆ˜ì •ëœ State ë°˜í™˜ (LangGraphê°€ ë‹¤ìŒ ë…¸ë“œë¡œ ì „ë‹¬)
    return state
```

**Checkpointing (State ì˜ì†í™”)**:

- PostgreSQL ê¸°ë°˜ Checkpointer ì‚¬ìš©
- ê° ë…¸ë“œ ì‹¤í–‰ í›„ State ìë™ ì €ì¥
- ì—ëŸ¬ ë°œìƒ ì‹œ ë§ˆì§€ë§‰ Checkpointë¶€í„° ì¬ê°œ ê°€ëŠ¥
- `thread_id` (chat_session_id)ë¡œ ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬

---

## 7. Agent ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### 7.1 Agent Registry

**íŒŒì¼**: `backend/app/service_agent/foundation/agent_registry.py`

**ì—­í• **: ëª¨ë“  Agentë¥¼ ì¤‘ì•™ ì§‘ì¤‘ì‹ìœ¼ë¡œ ê´€ë¦¬

```python
class AgentRegistry:
    _agents: Dict[str, AgentAdapter] = {}

    @classmethod
    def register(cls, name: str, agent: AgentAdapter):
        """Agent ë“±ë¡"""
        cls._agents[name] = agent

    @classmethod
    def get(cls, name: str) -> AgentAdapter:
        """Agent ê°€ì ¸ì˜¤ê¸°"""
        return cls._agents.get(name)

    @classmethod
    def list_agents(cls) -> List[str]:
        """ë“±ë¡ëœ Agent ëª©ë¡"""
        return list(cls._agents.keys())
```

**ë“±ë¡ëœ Agent**:
- `search_executor`
- `document_executor`
- `analysis_executor`
- `planning_agent`
- `query_decomposer`

### 7.2 Agent Adapter Pattern

**íŒŒì¼**: `backend/app/service_agent/foundation/agent_adapter.py`

**ëª©ì **: Agent ì¸í„°í˜ì´ìŠ¤ í‘œì¤€í™”

```python
class AgentAdapter:
    def __init__(self, agent_instance, capabilities: Dict):
        self.agent = agent_instance
        self.capabilities = capabilities

    async def execute(self, inputs: Dict) -> Dict:
        """í‘œì¤€í™”ëœ ì‹¤í–‰ ì¸í„°í˜ì´ìŠ¤"""
        return await self.agent.execute(inputs)

    def get_capabilities(self) -> Dict:
        """Agent ëŠ¥ë ¥ ì •ë³´"""
        return self.capabilities
```

**Capabilities ì˜ˆì‹œ**:

```python
{
    "name": "search_executor",
    "description": "ë²•ë¥ , ì‹œì„¸, ëŒ€ì¶œ, ë§¤ë¬¼ ê²€ìƒ‰",
    "input_schema": {
        "query": "string",
        "keywords": "SearchKeywords",
        "filters": "dict"
    },
    "output_schema": {
        "results": "list",
        "total_count": "int",
        "search_time": "float"
    },
    "supported_tasks": [
        "legal_search",
        "market_data_search",
        "property_search",
        "loan_search"
    ]
}
```

---

## 8. LLM í†µí•© ì „ëµ

### 8.1 LLMService ì•„í‚¤í…ì²˜

**íŒŒì¼**: `backend/app/service_agent/llm_manager/llm_service.py`

**í•µì‹¬ ê¸°ëŠ¥**:
1. **ì‹±ê¸€í†¤ í´ë¼ì´ì–¸íŠ¸ ìºì‹±** - ì¬ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”
2. **í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ í˜¸ì¶œ** - í…œí”Œë¦¿ ê´€ë¦¬ ìš©ì´
3. **ë™ê¸°/ë¹„ë™ê¸° ì§€ì›** - ìœ ì—°í•œ í˜¸ì¶œ ë°©ì‹
4. **ì—ëŸ¬ í•¸ë“¤ë§** - ì¬ì‹œë„ ë¡œì§

**ì£¼ìš” ë©”ì„œë“œ**:

```python
class LLMService:
    # ë™ê¸° í˜¸ì¶œ (í…ìŠ¤íŠ¸ ì‘ë‹µ)
    def complete(self, prompt_name: str, variables: Dict, **kwargs) -> str:
        """í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ LLM í˜¸ì¶œ (ë™ê¸°)"""
        pass

    # ë¹„ë™ê¸° í˜¸ì¶œ (í…ìŠ¤íŠ¸ ì‘ë‹µ)
    async def complete_async(self, prompt_name: str, variables: Dict, **kwargs) -> str:
        """í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ LLM í˜¸ì¶œ (ë¹„ë™ê¸°)"""
        pass

    # ë¹„ë™ê¸° í˜¸ì¶œ (JSON ì‘ë‹µ)
    async def complete_json_async(self, prompt_name: str, variables: Dict, **kwargs) -> Dict:
        """í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ LLM í˜¸ì¶œ (JSON ì‘ë‹µ)"""
        pass
```

### 8.2 PromptManager

**íŒŒì¼**: `backend/app/service_agent/llm_manager/prompt_manager.py`

**í”„ë¡¬í”„íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°**:

```
prompts/
â”œâ”€â”€ cognitive/                # ì¸ì§€ ê´€ë ¨
â”‚   â”œâ”€â”€ intent_analysis.txt
â”‚   â”œâ”€â”€ agent_selection.txt
â”‚   â””â”€â”€ query_decomposition.txt
â”œâ”€â”€ common/                   # ê³µí†µ
â”‚   â”œâ”€â”€ response_synthesis.txt
â”‚   â””â”€â”€ clarification.txt
â””â”€â”€ execution/               # ì‹¤í–‰ ê´€ë ¨
    â”œâ”€â”€ search_refinement.txt
    â”œâ”€â”€ document_generation.txt
    â””â”€â”€ analysis_interpretation.txt
```

**í”„ë¡¬í”„íŠ¸ ë¡œë”© ë° ë³€ìˆ˜ ì¹˜í™˜**:

```python
class PromptManager:
    def load_prompt(self, prompt_name: str, variables: Dict = None) -> str:
        """í”„ë¡¬í”„íŠ¸ ë¡œë“œ ë° ë³€ìˆ˜ ì¹˜í™˜"""
        # 1. í”„ë¡¬í”„íŠ¸ íŒŒì¼ ê²€ìƒ‰ (3ê°œ ë””ë ‰í† ë¦¬)
        prompt_path = self._find_prompt_file(prompt_name)

        # 2. íŒŒì¼ ì½ê¸°
        with open(prompt_path, 'r', encoding='utf-8') as f:
            template = f.read()

        # 3. ë³€ìˆ˜ ì¹˜í™˜ ({{variable}} â†’ value)
        if variables:
            for key, value in variables.items():
                template = template.replace(f"{{{{{key}}}}}", str(value))

        return template
```

**í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ** (`intent_analysis.txt`):

```
ë‹¹ì‹ ì€ ë¶€ë™ì‚° ìƒë‹´ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ì˜ë„ë¥¼ íŒŒì•…í•˜ì„¸ìš”.

ì§ˆë¬¸: {{query}}

ëŒ€í™” íˆìŠ¤í† ë¦¬:
{{chat_history}}

ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ì˜ë„ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:
- LEGAL_INQUIRY: ë²•ë¥  ê´€ë ¨ ì§ˆë¬¸
- MARKET_INQUIRY: ì‹œì„¸ ê´€ë ¨ ì§ˆë¬¸
- LOAN_SEARCH: ëŒ€ì¶œ ê´€ë ¨ ì§ˆë¬¸
...

JSON í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”:
{
  "intent": "LEGAL_INQUIRY",
  "confidence": 0.95,
  "keywords": ["ì „ì„¸ê¸ˆ", "ì¸ìƒ"],
  "reasoning": "...",
  "entities": {}
}
```

### 8.3 LLM í˜¸ì¶œ ìµœì í™”

**ì„±ëŠ¥ ìµœì í™” ì „ëµ**:

1. **Temperature ì¡°ì •**
   - Intent ë¶„ì„: `temperature=0.0` (ê²°ì •ë¡ ì )
   - ë‹µë³€ ìƒì„±: `temperature=0.7` (ì°½ì˜ì )

2. **Max Tokens ì œí•œ**
   - Intent ë¶„ì„: `max_tokens=500`
   - ë‹µë³€ ìƒì„±: `max_tokens=2000`

3. **ì¡°ê¸° ì¢…ë£Œ**
   - IRRELEVANT/UNCLEAR ì§ˆë¬¸ì€ Agent ì„ íƒ ìƒëµ

4. **ìºì‹±**
   - ë™ì¼í•œ ì§ˆë¬¸ì€ ì´ì „ ê²°ê³¼ ì¬ì‚¬ìš© (ì˜ˆì •)

---

## 9. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 9.1 PostgreSQL ìŠ¤í‚¤ë§ˆ

#### 9.1.1 users í…Œì´ë¸”

```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 9.1.2 chat_sessions í…Œì´ë¸”

```sql
CREATE TABLE chat_sessions (
    session_id VARCHAR(100) PRIMARY KEY,  -- WebSocket session ID
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(200) NOT NULL DEFAULT 'ìƒˆ ëŒ€í™”',
    last_message TEXT,
    message_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    is_active BOOLEAN DEFAULT TRUE,
    metadata JSONB
);

CREATE INDEX idx_chat_sessions_user_id ON chat_sessions(user_id);
CREATE INDEX idx_chat_sessions_updated_at ON chat_sessions(updated_at);
CREATE INDEX idx_chat_sessions_user_updated ON chat_sessions(user_id, updated_at);
```

#### 9.1.3 chat_messages í…Œì´ë¸”

```sql
CREATE TABLE chat_messages (
    id SERIAL PRIMARY KEY,
    session_id VARCHAR(100) NOT NULL REFERENCES chat_sessions(session_id) ON DELETE CASCADE,
    role VARCHAR(20) NOT NULL,  -- 'user' | 'assistant' | 'system'
    content TEXT NOT NULL,
    structured_data JSONB,      -- UIìš© êµ¬ì¡°í™”ëœ ë°ì´í„°
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_chat_messages_session_id ON chat_messages(session_id);
CREATE INDEX idx_chat_messages_created_at ON chat_messages(created_at);
```

**structured_data ì˜ˆì‹œ**:

```json
{
  "sections": [
    {
      "title": "í•µì‹¬ ë‹µë³€",
      "content": "ì „ì„¸ê¸ˆ ì¦ì•¡ì€ 5% ì´ë‚´ë¡œ ì œí•œë©ë‹ˆë‹¤.",
      "icon": "target"
    },
    {
      "title": "ë²•ë¥  ê·¼ê±°",
      "content": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°",
      "icon": "law"
    }
  ],
  "metadata": {
    "sources": ["ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²•"],
    "confidence": 0.95,
    "search_time": 1.2
  }
}
```

#### 9.1.4 real_estates í…Œì´ë¸”

```sql
CREATE TABLE real_estates (
    id SERIAL PRIMARY KEY,
    property_type VARCHAR(50),   -- 'ì•„íŒŒíŠ¸' | 'ì˜¤í”¼ìŠ¤í…”' | 'ë¹Œë¼' | 'ì›ë£¸'
    transaction_type VARCHAR(20), -- 'ë§¤ë§¤' | 'ì „ì„¸' | 'ì›”ì„¸'
    address TEXT,
    price BIGINT,
    area_sqm FLOAT,
    floor INTEGER,
    building_year INTEGER,
    latitude FLOAT,
    longitude FLOAT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_real_estates_type ON real_estates(property_type, transaction_type);
CREATE INDEX idx_real_estates_price ON real_estates(price);
CREATE INDEX idx_real_estates_location ON real_estates(latitude, longitude);
```

#### 9.1.5 transactions í…Œì´ë¸”

```sql
CREATE TABLE transactions (
    id SERIAL PRIMARY KEY,
    property_id INTEGER REFERENCES real_estates(id),
    transaction_date DATE,
    transaction_price BIGINT,
    transaction_type VARCHAR(20),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_transactions_date ON transactions(transaction_date);
CREATE INDEX idx_transactions_property ON transactions(property_id);
```

### 9.2 Vector Database (FAISS)

**ìš©ë„**: ë²•ë¥  ë¬¸ì„œ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰

**êµ¬ì¡°**:
```
backend/data/legal/
â”œâ”€â”€ faiss.index           # FAISS ì¸ë±ìŠ¤ íŒŒì¼
â”œâ”€â”€ chunks_metadata.json  # ì²­í¬ ë©”íƒ€ë°ì´í„°
â””â”€â”€ sqlite_metadata.db    # SQLite ë³´ì¡° DB
```

**ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ**:

```python
{
    "chunk_id": "ë²•ë¥ _0001",
    "law_name": "ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²•",
    "article": "ì œ7ì¡°",
    "content": "ì„ëŒ€ë£Œ ì¦ì•¡ì€ ì—° 5% ì´ë‚´ë¡œ ì œí•œëœë‹¤.",
    "embedding": [0.1, 0.2, ...],  # 768ì°¨ì› ë²¡í„°
    "created_at": "2025-01-20"
}
```

**ê²€ìƒ‰ í”„ë¡œì„¸ìŠ¤**:

1. **ì¿¼ë¦¬ ì„ë² ë”©**: "ì „ì„¸ê¸ˆ ì¸ìƒ" â†’ [0.3, 0.4, ...]
2. **FAISS ê²€ìƒ‰**: ìœ ì‚¬ë„ ìƒìœ„ 5ê°œ ê²€ìƒ‰
3. **SQLite í•„í„°**: í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ ì¶”ê°€ í•„í„°ë§
4. **ê²°ê³¼ ë³‘í•©**: ì¤‘ë³µ ì œê±°, ì ìˆ˜ ê¸°ë°˜ ì •ë ¬

### 9.3 SQLite (DecisionLogger)

**ìš©ë„**: Agent ì˜ì‚¬ê²°ì • ê³¼ì • ë¡œê¹…

**íŒŒì¼**: `backend/data/system/agent_logging/decisions.db`

**ìŠ¤í‚¤ë§ˆ**:

```sql
CREATE TABLE decisions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT,
    agent_name TEXT,
    decision_type TEXT,  -- 'intent_analysis' | 'agent_selection' | 'execution'
    input_data TEXT,     -- JSON
    output_data TEXT,    -- JSON
    reasoning TEXT,
    confidence FLOAT,
    timestamp TEXT
);

CREATE INDEX idx_decisions_session ON decisions(session_id);
CREATE INDEX idx_decisions_agent ON decisions(agent_name);
```

---

## 10. WebSocket í†µì‹  íŒ¨í„´

### 10.1 ì—°ê²° ê´€ë¦¬

**ConnectionManager** (`ws_manager.py`):

```python
class ConnectionManager:
    def __init__(self):
        self.active_connections: Dict[str, WebSocket] = {}

    async def connect(self, session_id: str, websocket: WebSocket):
        """WebSocket ì—°ê²° ì¶”ê°€"""
        await websocket.accept()
        self.active_connections[session_id] = websocket

    async def disconnect(self, session_id: str):
        """WebSocket ì—°ê²° ì œê±°"""
        if session_id in self.active_connections:
            del self.active_connections[session_id]

    async def send_message(self, session_id: str, message: dict):
        """ë©”ì‹œì§€ ì „ì†¡"""
        websocket = self.active_connections.get(session_id)
        if websocket:
            await websocket.send_json(message)
```

### 10.2 ë©”ì‹œì§€ íƒ€ì…

| íƒ€ì… | ë°©í–¥ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|------|
| `connected` | Server â†’ Client | ì—°ê²° í™•ì¸ | `{"type": "connected", "session_id": "..."}` |
| `query` | Client â†’ Server | ì‚¬ìš©ì ì§ˆë¬¸ | `{"type": "query", "query": "..."}` |
| `supervisor_phase_change` | Server â†’ Client | Supervisor ë‹¨ê³„ ë³€ê²½ | `{"type": "supervisor_phase_change", "supervisorPhase": "analyzing"}` |
| `team_progress` | Server â†’ Client | íŒ€ ì§„í–‰ ìƒí™© | `{"type": "team_progress", "team": "search", "progress": 50}` |
| `search_result` | Server â†’ Client | ê²€ìƒ‰ ê²°ê³¼ (ì¤‘ê°„) | `{"type": "search_result", "results": [...]}` |
| `final_response` | Server â†’ Client | ìµœì¢… ë‹µë³€ | `{"type": "final_response", "response": {...}}` |
| `error` | Server â†’ Client | ì—ëŸ¬ ë°œìƒ | `{"type": "error", "message": "..."}` |

### 10.3 ì‹¤ì‹œê°„ Progress Flow

**Supervisor Phase**:

```json
// 5% - Dispatching
{
  "type": "supervisor_phase_change",
  "supervisorPhase": "dispatching",
  "supervisorProgress": 5,
  "message": "ì§ˆë¬¸ì„ ì ‘ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤"
}

// 10% - Analyzing
{
  "type": "supervisor_phase_change",
  "supervisorPhase": "analyzing",
  "supervisorProgress": 10,
  "message": "ì§ˆë¬¸ì„ ë¶„ì„í•˜ê³  ê³„íšì„ ìˆ˜ë¦½í•˜ê³  ìˆìŠµë‹ˆë‹¤"
}

// 20% - Executing
{
  "type": "supervisor_phase_change",
  "supervisorPhase": "executing",
  "supervisorProgress": 20,
  "message": "ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤"
}
```

**Team Progress**:

```json
// Search íŒ€ ì§„í–‰
{
  "type": "team_progress",
  "team": "search",
  "progress": 30,
  "current_task": "ë²•ë¥  ì •ë³´ ê²€ìƒ‰ ì¤‘",
  "completed_tasks": ["í‚¤ì›Œë“œ ì¶”ì¶œ"],
  "pending_tasks": ["ì‹œì„¸ ì¡°íšŒ", "ëŒ€ì¶œ ìƒí’ˆ ê²€ìƒ‰"]
}
```

---

## 11. ì„¤ê³„ íŒ¨í„´ ë° ì›ì¹™

### 11.1 ì ìš©ëœ ë””ìì¸ íŒ¨í„´

#### 11.1.1 Singleton Pattern

**ì ìš© ìœ„ì¹˜**: TeamBasedSupervisor, LLMService

**ì´ìœ **:
- ë©”ëª¨ë¦¬ ì ˆì•½ (LLM í´ë¼ì´ì–¸íŠ¸, Agent ì¬ì‚¬ìš©)
- ì„±ëŠ¥ ìµœì í™” (ì´ˆê¸°í™” ë¹„ìš© ì ˆê°)
- ìƒíƒœ ê³µìœ  (ëª¨ë“  ì„¸ì…˜ì´ ë™ì¼í•œ Supervisor ì‚¬ìš©)

```python
_supervisor_instance = None
_supervisor_lock = asyncio.Lock()

async def get_supervisor(enable_checkpointing=True):
    global _supervisor_instance
    async with _supervisor_lock:
        if _supervisor_instance is None:
            _supervisor_instance = TeamBasedSupervisor(...)
        return _supervisor_instance
```

#### 11.1.2 Strategy Pattern

**ì ìš© ìœ„ì¹˜**: Intent Analysis (LLM vs Pattern Matching)

**ì´ìœ **: ìœ ì—°í•œ ì•Œê³ ë¦¬ì¦˜ ì „í™˜

```python
async def analyze_intent(self, query, context):
    # ì „ëµ 1: LLM ê¸°ë°˜ ë¶„ì„
    if self.llm_service:
        try:
            return await self._analyze_with_llm(query, context)
        except:
            pass

    # ì „ëµ 2: íŒ¨í„´ ë§¤ì¹­ (Fallback)
    return self._analyze_with_patterns(query, context)
```

#### 11.1.3 Adapter Pattern

**ì ìš© ìœ„ì¹˜**: AgentAdapter

**ì´ìœ **: Agent ì¸í„°í˜ì´ìŠ¤ í‘œì¤€í™”

```python
class AgentAdapter:
    def __init__(self, agent_instance, capabilities):
        self.agent = agent_instance
        self.capabilities = capabilities

    async def execute(self, inputs: Dict) -> Dict:
        return await self.agent.execute(inputs)
```

#### 11.1.4 Observer Pattern

**ì ìš© ìœ„ì¹˜**: Progress Callback

**ì´ìœ **: ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì „íŒŒ

```python
# Supervisorê°€ ì§„í–‰ ìƒí™© ë¸Œë¡œë“œìºìŠ¤íŠ¸
await progress_callback("team_progress", {"team": "search", "progress": 50})

# WebSocket Managerê°€ êµ¬ë…í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡
await conn_mgr.send_message(session_id, {...})
```

#### 11.1.5 State Pattern

**ì ìš© ìœ„ì¹˜**: LangGraph State Machine

**ì´ìœ **: ë³µì¡í•œ ì›Œí¬í”Œë¡œìš° ìƒíƒœ ê´€ë¦¬

```python
# ê° ë…¸ë“œê°€ Stateë¥¼ ìˆ˜ì •í•˜ë©° ë‹¤ìŒ ë…¸ë“œë¡œ ì „ë‹¬
workflow.add_node("initialize", self.initialize_node)
workflow.add_node("planning", self.planning_node)
...
```

### 11.2 SOLID ì›ì¹™ ì ìš©

#### Single Responsibility Principle (SRP)
- âœ… ê° ExecutorëŠ” í•˜ë‚˜ì˜ ë„ë©”ì¸ë§Œ ë‹´ë‹¹ (Search, Document, Analysis)
- âœ… PlanningAgentëŠ” ê³„íšë§Œ, ExecutorëŠ” ì‹¤í–‰ë§Œ

#### Open/Closed Principle (OCP)
- âœ… ìƒˆë¡œìš´ Tool ì¶”ê°€ ì‹œ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
- âœ… AgentRegistryë¡œ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°

#### Liskov Substitution Principle (LSP)
- âœ… ëª¨ë“  ExecutorëŠ” ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
- âœ… AgentAdapterë¡œ ì¹˜í™˜ ê°€ëŠ¥

#### Interface Segregation Principle (ISP)
- âœ… Toolë³„ë¡œ ë…ë¦½ì ì¸ ì¸í„°í˜ì´ìŠ¤
- âœ… ë¶ˆí•„ìš”í•œ ë©”ì„œë“œ ê°•ì œí•˜ì§€ ì•ŠìŒ

#### Dependency Inversion Principle (DIP)
- âœ… SupervisorëŠ” êµ¬ì²´ì ì¸ Executorê°€ ì•„ë‹Œ AgentAdapterì— ì˜ì¡´
- âœ… LLMServiceëŠ” ì¶”ìƒ LLMContextì— ì˜ì¡´

---

## 12. í™•ì¥ì„± ë° ì„±ëŠ¥

### 12.1 í™•ì¥ì„± ì„¤ê³„

#### 12.1.1 ìˆ˜í‰ í™•ì¥ (Horizontal Scaling)

**í˜„ì¬ ì œì•½**:
- Supervisor ì‹±ê¸€í†¤ íŒ¨í„´ (ë‹¨ì¼ í”„ë¡œì„¸ìŠ¤)
- WebSocket ì—°ê²°ì´ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ì— ë°”ì¸ë”©

**í–¥í›„ ê°œì„  ë°©ì•ˆ**:
```python
# Phase 3: Redis ê¸°ë°˜ ë¶„ì‚° State ê´€ë¦¬
class DistributedSupervisor:
    def __init__(self, redis_client):
        self.redis = redis_client

    async def get_state(self, session_id):
        return await self.redis.get(f"state:{session_id}")

    async def set_state(self, session_id, state):
        await self.redis.set(f"state:{session_id}", state)
```

#### 12.1.2 ìƒˆë¡œìš´ Tool ì¶”ê°€

**í™•ì¥ íŒ¨í„´**:

```python
# 1. Tool í´ë˜ìŠ¤ ìƒì„±
class NewTool:
    async def execute(self, inputs: Dict) -> Dict:
        # Tool ë¡œì§
        return {"results": [...]}

# 2. Executorì— Tool ì¶”ê°€
class SearchExecutor:
    def __init__(self):
        self.new_tool = NewTool()

    async def execute(self, inputs):
        # new_tool ì‚¬ìš©
        pass

# 3. ìë™ ë“±ë¡ (Agent Registry)
```

#### 12.1.3 ìƒˆë¡œìš´ Intent ì¶”ê°€

```python
# 1. IntentType Enumì— ì¶”ê°€
class IntentType(Enum):
    NEW_INTENT = "ìƒˆë¡œìš´ì˜ë„"

# 2. íŒ¨í„´ ì¶”ê°€
intent_patterns = {
    IntentType.NEW_INTENT: ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]
}

# 3. Intent â†’ Agent ë§¤í•‘ ì¶”ê°€
intent_to_agent = {
    IntentType.NEW_INTENT: ["search_team"]
}
```

### 12.2 ì„±ëŠ¥ ìµœì í™”

#### 12.2.1 ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ì‹±

```sql
-- í•„ìˆ˜ ì¸ë±ìŠ¤
CREATE INDEX idx_chat_messages_session_id ON chat_messages(session_id);
CREATE INDEX idx_real_estates_price ON real_estates(price);
CREATE INDEX idx_transactions_date ON transactions(transaction_date);
```

#### 12.2.2 ë¹„ë™ê¸° ì²˜ë¦¬

```python
# ë³‘ë ¬ ê²€ìƒ‰ ì‹¤í–‰
async def execute_parallel_search(self, keywords):
    tasks = [
        self.legal_search_tool.search(keywords["legal"]),
        self.market_data_tool.search(keywords["real_estate"]),
        self.loan_data_tool.search(keywords["loan"])
    ]
    results = await asyncio.gather(*tasks)
    return results
```

#### 12.2.3 ìºì‹± ì „ëµ (ì˜ˆì •)

```python
# Phase 2: Redis ìºì‹±
class CachedLLMService:
    async def complete_async(self, prompt_name, variables):
        cache_key = f"{prompt_name}:{hash(variables)}"

        # ìºì‹œ í™•ì¸
        cached = await redis.get(cache_key)
        if cached:
            return cached

        # LLM í˜¸ì¶œ
        result = await self.llm_service.complete_async(...)

        # ìºì‹œ ì €ì¥ (5ë¶„ TTL)
        await redis.set(cache_key, result, ex=300)
        return result
```

### 12.3 ì„±ëŠ¥ ë©”íŠ¸ë¦­

**í˜„ì¬ ì„±ëŠ¥ (ë¡œì»¬ í™˜ê²½)**:

| ì‘ì—… | í‰ê·  ì‹œê°„ | ë¹„ê³  |
|------|-----------|------|
| WebSocket ì—°ê²° | ~50ms | ì„¸ì…˜ ê²€ì¦ í¬í•¨ |
| Intent ë¶„ì„ (LLM) | ~800ms | GPT-4 í˜¸ì¶œ |
| Intent ë¶„ì„ (Pattern) | ~10ms | Fallback |
| Agent ì„ íƒ | ~500ms | LLM í˜¸ì¶œ |
| ë²•ë¥  ê²€ìƒ‰ (FAISS) | ~200ms | 5ê°œ ê²°ê³¼ |
| ë§¤ë¬¼ ê²€ìƒ‰ (PostgreSQL) | ~100ms | ì¸ë±ìŠ¤ í™œìš© |
| ìµœì¢… ë‹µë³€ ìƒì„± (LLM) | ~1500ms | GPT-4 í˜¸ì¶œ |
| **ì „ì²´ í”„ë¡œì„¸ìŠ¤** | **~3-5ì´ˆ** | ë‹¨ìˆœ ì§ˆë¬¸ ê¸°ì¤€ |

---

## 13. ë³´ì•ˆ ë° ì—ëŸ¬ ì²˜ë¦¬

### 13.1 ë³´ì•ˆ ì„¤ê³„

#### 13.1.1 ì¸ì¦ ë° ì¸ê°€

**í˜„ì¬ ìƒíƒœ**: `user_id = 1` í•˜ë“œì½”ë”© (ê°œë°œ ë‹¨ê³„)

**í–¥í›„ êµ¬í˜„**:

```python
# JWT ê¸°ë°˜ ì¸ì¦
from jose import JWTError, jwt

@router.websocket("/ws/{session_id}")
async def websocket_chat(
    websocket: WebSocket,
    session_id: str,
    token: str = Query(...)  # Query parameterë¡œ JWT ì „ë‹¬
):
    # JWT ê²€ì¦
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        user_id = payload.get("user_id")
    except JWTError:
        await websocket.close(code=4003, reason="Unauthorized")
        return

    # ì„¸ì…˜ ê²€ì¦
    # ...
```

#### 13.1.2 Input Validation

```python
# ì¿¼ë¦¬ ê¸¸ì´ ì œí•œ
MAX_QUERY_LENGTH = 500

if len(query) > MAX_QUERY_LENGTH:
    await conn_mgr.send_message(session_id, {
        "type": "error",
        "message": f"ì§ˆë¬¸ì€ {MAX_QUERY_LENGTH}ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”."
    })
    return
```

#### 13.1.3 SQL Injection ë°©ì§€

```python
# SQLAlchemy ORM ì‚¬ìš© (ìë™ ì´ìŠ¤ì¼€ì´í•‘)
query = select(RealEstate).where(RealEstate.price <= max_price)
result = await db.execute(query)
```

#### 13.1.4 Rate Limiting (ì˜ˆì •)

```python
from slowapi import Limiter

limiter = Limiter(key_func=get_remote_address)

@router.post("/sessions/start")
@limiter.limit("10/minute")  # 1ë¶„ì— 10ë²ˆ
async def start_session(request: SessionStartRequest):
    pass
```

### 13.2 ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

#### 13.2.1 ê³„ì¸µë³„ ì—ëŸ¬ ì²˜ë¦¬

```python
# Layer 0: WebSocket ì—°ê²° ì—ëŸ¬
try:
    await websocket.accept()
except Exception as e:
    logger.error(f"WebSocket accept failed: {e}")
    return

# Layer 1: Supervisor ì—ëŸ¬
try:
    result = await supervisor.process_query_streaming(...)
except Exception as e:
    logger.error(f"Supervisor error: {e}", exc_info=True)
    await conn_mgr.send_message(session_id, {
        "type": "error",
        "message": "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
    })

# Layer 3: LLM í˜¸ì¶œ ì—ëŸ¬
try:
    result = await self.llm_service.complete_async(...)
except Exception as e:
    logger.warning(f"LLM call failed: {e}, falling back to pattern matching")
    # Fallback ë¡œì§
```

#### 13.2.2 Graceful Degradation

```python
# LLM ì‹¤íŒ¨ ì‹œ Pattern Matchingìœ¼ë¡œ Fallback
async def analyze_intent(self, query, context):
    if self.llm_service:
        try:
            return await self._analyze_with_llm(query, context)
        except Exception as e:
            logger.warning(f"LLM analysis failed: {e}")

    # Fallback: íŒ¨í„´ ë§¤ì¹­
    return self._analyze_with_patterns(query, context)
```

#### 13.2.3 ì—ëŸ¬ ë¡œê¹…

```python
# DecisionLoggerì— ì—ëŸ¬ ê¸°ë¡
try:
    result = await agent.execute(inputs)
except Exception as e:
    self.decision_logger.log_error(
        session_id=session_id,
        agent_name=agent_name,
        error_type=type(e).__name__,
        error_message=str(e),
        traceback=traceback.format_exc()
    )
    raise
```

---

## 14. ê°œë°œ ë¡œë“œë§µ

### 14.1 í˜„ì¬ ë²„ì „ (Beta v0.01)

**ì™„ë£Œëœ ê¸°ëŠ¥**:
- âœ… Multi-Agent ì•„í‚¤í…ì²˜ (3ê°œ íŒ€)
- âœ… LangGraph ì›Œí¬í”Œë¡œìš°
- âœ… 15ê°œ ì˜ë„ ë¶„ë¥˜
- âœ… WebSocket ì‹¤ì‹œê°„ í†µì‹ 
- âœ… Hybrid Search (FAISS + SQL)
- âœ… Chat History ê´€ë¦¬
- âœ… HITL ê¸°ë³¸ êµ¬ì¡°
- âœ… DecisionLogger
- âœ… 14ê°œ Tool í†µí•©

### 14.2 Phase 1 (í˜„ì¬ ì§„í–‰ ì¤‘)

**ëª©í‘œ**: Core Functionality ì•ˆì •í™”

- ğŸ”„ QueryDecomposer ê³ ë„í™”
- ğŸ”„ HITL ì›Œí¬í”Œë¡œìš° ì™„ì„±
- ğŸ”„ Frontend UI/UX ê°œì„ 
- ğŸ”„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

### 14.3 Phase 2 (ì˜ˆì •)

**ëª©í‘œ**: Performance & Scalability

- ğŸ“‹ Redis ìºì‹± ë„ì…
- ğŸ“‹ LLM ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° (Server-Sent Events)
- ğŸ“‹ StandardResult ë³¸ê²© í™œìš©
- ğŸ“‹ Agent ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- ğŸ“‹ 3-Tier Memory ê³ ë„í™”

### 14.4 Phase 3 (ì˜ˆì •)

**ëª©í‘œ**: Enterprise Features

- ğŸ“‹ ë¶„ì‚° ì•„í‚¤í…ì²˜ (Multi-instance)
- ğŸ“‹ A/B í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
- ğŸ“‹ ì‚¬ìš©ì í”¼ë“œë°± ì‹œìŠ¤í…œ
- ğŸ“‹ RAG (Retrieval-Augmented Generation) ê°œì„ 
- ğŸ“‹ Multi-modal ì§€ì› (ì´ë¯¸ì§€ ë¶„ì„)

---

## 15. ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### 15.1 ì‹œìŠ¤í…œ ê°•ì 

#### 15.1.1 ì•„í‚¤í…ì²˜ ì„¤ê³„
- âœ… **ëª…í™•í•œ ê³„ì¸µ ë¶„ë¦¬** - ê° ê³„ì¸µì´ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë° ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥
- âœ… **í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°** - ìƒˆë¡œìš´ Tool/Intent ì¶”ê°€ ìš©ì´
- âœ… **ëª¨ë“ˆí™”** - Agent, Tool, Executor ë…ë¦½ ê°œë°œ ê°€ëŠ¥

#### 15.1.2 ê¸°ìˆ  ìŠ¤íƒ
- âœ… **ìµœì‹  ê¸°ìˆ  ì ìš©** - LangGraph 0.6, FastAPI, Next.js 14
- âœ… **ë¹„ë™ê¸° ì²˜ë¦¬** - ë†’ì€ ë™ì‹œì„± ì§€ì›
- âœ… **íƒ€ì… ì•ˆì •ì„±** - TypedDict, Pydanticìœ¼ë¡œ íƒ€ì… ê²€ì¦

#### 15.1.3 ì‚¬ìš©ì ê²½í—˜
- âœ… **ì‹¤ì‹œê°„ í”¼ë“œë°±** - WebSocketìœ¼ë¡œ ì§„í–‰ ìƒí™© ì‹¤ì‹œê°„ ì „ë‹¬
- âœ… **Context-Aware** - ëŒ€í™” íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ë§¥ë½ ì´í•´
- âœ… **Multi-modal Output** - í…ìŠ¤íŠ¸ + êµ¬ì¡°í™”ëœ ë°ì´í„°

### 15.2 ê°œì„  í•„ìš” ì‚¬í•­

#### 15.2.1 ì„±ëŠ¥
- âš ï¸ **LLM í˜¸ì¶œ ì‹œê°„** - í‰ê·  3-5ì´ˆ (ìºì‹±ìœ¼ë¡œ ê°œì„  í•„ìš”)
- âš ï¸ **ë³‘ë ¬ ì²˜ë¦¬** - ì¼ë¶€ ê²€ìƒ‰ì´ ìˆœì°¨ ì‹¤í–‰ (ê°œì„  ì—¬ì§€)

#### 15.2.2 ì¸í”„ë¼
- âš ï¸ **ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤** - ìˆ˜í‰ í™•ì¥ ë¶ˆê°€ (Redis ë„ì… í•„ìš”)
- âš ï¸ **í•˜ë“œì½”ë”©ëœ ì„¤ì •** - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ ê°œì„  í•„ìš”

#### 15.2.3 ë³´ì•ˆ
- âš ï¸ **ì¸ì¦ ë¯¸êµ¬í˜„** - JWT ê¸°ë°˜ ì¸ì¦ ì‹œê¸‰
- âš ï¸ **Rate Limiting ì—†ìŒ** - API ë‚¨ìš© ë°©ì§€ í•„ìš”

### 15.3 ê¶Œì¥ ì‚¬í•­

#### 15.3.1 ë‹¨ê¸° (1-2ê°œì›”)
1. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±** - Unit/Integration í…ŒìŠ¤íŠ¸ (ì½”ë“œ ì»¤ë²„ë¦¬ì§€ 80% ëª©í‘œ)
2. **JWT ì¸ì¦ êµ¬í˜„** - ë³´ì•ˆ ê°•í™”
3. **ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ ** - ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§** - Prometheus + Grafana ë„ì…

#### 15.3.2 ì¤‘ê¸° (3-6ê°œì›”)
1. **Redis ìºì‹±** - LLM ì‘ë‹µ ë° ê²€ìƒ‰ ê²°ê³¼ ìºì‹±
2. **LLM ìŠ¤íŠ¸ë¦¬ë°** - Server-Sent Eventsë¡œ ì‹¤ì‹œê°„ ì‘ë‹µ
3. **ë¶„ì‚° ì•„í‚¤í…ì²˜** - Redis ê¸°ë°˜ State ê³µìœ 
4. **CI/CD íŒŒì´í”„ë¼ì¸** - ìë™í™”ëœ ë°°í¬

#### 15.3.3 ì¥ê¸° (6-12ê°œì›”)
1. **Multi-modal ì§€ì›** - ì´ë¯¸ì§€ ë¶„ì„ (ë¶€ë™ì‚° ì‚¬ì§„, ê³„ì•½ì„œ ìŠ¤ìº”)
2. **Fine-tuning** - ë¶€ë™ì‚° ë„ë©”ì¸ íŠ¹í™” LLM
3. **A/B í…ŒìŠ¤íŠ¸** - Intent ë¶„ì„ ì•Œê³ ë¦¬ì¦˜ ê°œì„ 
4. **ì‚¬ìš©ì í”¼ë“œë°± ë£¨í”„** - RLHF (Reinforcement Learning from Human Feedback)

### 15.4 ìµœì¢… í‰ê°€

**HolmesNyangz ì±—ë´‡ ì‹œìŠ¤í…œì€ ê²¬ê³ í•œ ì•„í‚¤í…ì²˜ì™€ ìµœì‹  AI ê¸°ìˆ ì„ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì¶•ëœ ê³ í’ˆì§ˆ ë¶€ë™ì‚° ìƒë‹´ í”Œë«í¼ì…ë‹ˆë‹¤.**

**í•µì‹¬ ì„±ê³¼**:
- ğŸ† **Multi-Agent ì•„í‚¤í…ì²˜ ì„±ê³µì  êµ¬í˜„** - ê° íŒ€ì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™
- ğŸ† **ì‹¤ì‹œê°„ ëŒ€í™”í˜• UX** - WebSocket ê¸°ë°˜ ì¦‰ê°ì ì¸ í”¼ë“œë°±
- ğŸ† **í™•ì¥ ê°€ëŠ¥í•œ ì„¤ê³„** - ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ìš©ì´
- ğŸ† **Hybrid Search** - Vector + SQL ê²°í•©ìœ¼ë¡œ ë†’ì€ ê²€ìƒ‰ í’ˆì§ˆ

**í–¥í›„ ë°œì „ ë°©í–¥**:
- ğŸš€ **ì„±ëŠ¥ ìµœì í™”** - ìºì‹±, ë³‘ë ¬ ì²˜ë¦¬ ê°•í™”
- ğŸš€ **ë³´ì•ˆ ê°•í™”** - ì¸ì¦, ì¸ê°€, Rate Limiting
- ğŸš€ **ì¸í”„ë¼ ê°œì„ ** - ë¶„ì‚° ì•„í‚¤í…ì²˜, ìë™ ìŠ¤ì¼€ì¼ë§
- ğŸš€ **AI ê³ ë„í™”** - Fine-tuning, Multi-modal, RLHF

**ê²°ë¡ **: í˜„ì¬ ì‹œìŠ¤í…œì€ í”„ë¡œë•ì…˜ í™˜ê²½ì— ë°°í¬ ê°€ëŠ¥í•œ ìˆ˜ì¤€ì´ë©°, ì œì•ˆëœ ê°œì„  ì‚¬í•­ì„ ìˆœì°¨ì ìœ¼ë¡œ ì ìš©í•˜ë©´ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì„œë¹„ìŠ¤ë¡œ ë°œì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ë¶€ë¡

### A. ìš©ì–´ ì •ì˜

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| **Agent** | íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë…ë¦½ì ì¸ AI ì»´í¬ë„ŒíŠ¸ |
| **Executor** | íŒ€ ë‹¨ìœ„ë¡œ Agentë“¤ì„ ì‹¤í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ (SearchExecutor, DocumentExecutor, AnalysisExecutor) |
| **LangGraph** | AI workflow orchestration í”„ë ˆì„ì›Œí¬ |
| **State** | LangGraph ë…¸ë“œ ê°„ ì „ë‹¬ë˜ëŠ” ë°ì´í„° êµ¬ì¡° |
| **Checkpointing** | Stateë¥¼ ì €ì¥í•˜ì—¬ ì¬ê°œ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ |
| **HITL** | Human-in-the-Loop, ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° ì œì–´ |
| **Intent** | ì‚¬ìš©ì ì§ˆë¬¸ì˜ ì˜ë„ (15ê°œ ì¹´í…Œê³ ë¦¬) |
| **Tool** | ì‹¤ì œ ë°ì´í„° ê²€ìƒ‰/ë¶„ì„/ìƒì„±ì„ ìˆ˜í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ |
| **Supervisor** | ì „ì²´ Agent ì›Œí¬í”Œë¡œìš°ë¥¼ ì¡°ì •í•˜ëŠ” ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸ |

### B. íŒŒì¼ ì°¸ì¡°

**í•µì‹¬ íŒŒì¼ ê²½ë¡œ**:
- Backend Entry: `backend/app/main.py`
- WebSocket API: `backend/app/api/chat_api.py`
- Supervisor: `backend/app/service_agent/supervisor/team_supervisor.py`
- Planning Agent: `backend/app/service_agent/cognitive_agents/planning_agent.py`
- Search Executor: `backend/app/service_agent/execution_agents/search_executor.py`
- LLM Service: `backend/app/service_agent/llm_manager/llm_service.py`
- State Definitions: `backend/app/service_agent/foundation/separated_states.py`
- Database Models: `backend/app/models/chat.py`
- Config: `backend/app/core/config.py`

### C. ì°¸ê³  ë¬¸ì„œ

- [CHATBOT_COMPLETE_FLOW_MANUAL.md](CHATBOT_COMPLETE_FLOW_MANUAL.md) - ì „ì²´ íë¦„ ë§¤ë‰´ì–¼
- [CHATBOT_STRUCTURE_VERIFICATION_251030.md](CHATBOT_STRUCTURE_VERIFICATION_251030.md) - êµ¬ì¡° ê²€ì¦ ë³´ê³ ì„œ
- LangGraph Documentation: https://langchain-ai.github.io/langgraph/
- FastAPI Documentation: https://fastapi.tiangolo.com/
- Next.js Documentation: https://nextjs.org/docs

---

**ë¬¸ì„œ ë²„ì „**: 2.0
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-01-30
**ì‘ì„±ì**: System Analyst
**ë¬¸ì„œ ìƒíƒœ**: Complete
