# ê°œë°œì ê°€ì´ë“œ

**ì‘ì„±ì¼**: 2025-11-03
**ë²„ì „**: 0.4.0

---

## ëª©ì°¨

1. [ê°œë°œ í™˜ê²½ ì„¤ì •](#ê°œë°œ-í™˜ê²½-ì„¤ì •)
2. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
3. [ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€](#ìƒˆ-ì—ì´ì „íŠ¸-ì¶”ê°€)
4. [ì»¤ìŠ¤í…€ ë…¸ë“œ ì‘ì„±](#ì»¤ìŠ¤í…€-ë…¸ë“œ-ì‘ì„±)
5. [ì¶œë ¥ Generator ì»¤ìŠ¤í„°ë§ˆì´ì§•](#ì¶œë ¥-generator-ì»¤ìŠ¤í„°ë§ˆì´ì§•)
6. [í…ŒìŠ¤íŠ¸ ì‘ì„±](#í…ŒìŠ¤íŠ¸-ì‘ì„±)
7. [ë””ë²„ê¹…](#ë””ë²„ê¹…)
8. [ë°°í¬](#ë°°í¬)

---

## ê°œë°œ í™˜ê²½ ì„¤ì •

### ìš”êµ¬ì‚¬í•­

- Python 3.11+
- PostgreSQL 13+
- uv (Python íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
- Git

### ì„¤ì¹˜

#### 1. ì €ì¥ì†Œ í´ë¡ 

```bash
git clone <repository-url>
cd Octo_worker/beta_v002
```

#### 2. Python ê°€ìƒ í™˜ê²½ ë° ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# uvë¡œ ì˜ì¡´ì„± ë™ê¸°í™”
uv sync
```

#### 3. PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

```bash
# PostgreSQL ì ‘ì†
psql -U postgres

# ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE octo_chatbot;

# ì‚¬ìš©ì ìƒì„± (ì„ íƒì‚¬í•­)
CREATE USER octo_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE octo_chatbot TO octo_user;
```

#### 4. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì…ë ¥í•©ë‹ˆë‹¤:

```bash
# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key

# PostgreSQL
POSTGRES_URL=postgresql://postgres:your_password@localhost:5432/octo_chatbot

# System
SYSTEM_DEBUG=True
SYSTEM_API_HOST=0.0.0.0
SYSTEM_API_PORT=8000

# CORS
SYSTEM_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:5173
```

#### 5. ì„œë²„ ì‹¤í–‰

```bash
# ê°œë°œ ëª¨ë“œë¡œ ì„œë²„ ì‹¤í–‰
uv run python run_server.py
```

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
beta_v002/
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ main.py                    # FastAPI ì•± ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚       â”œâ”€â”€ api/                       # API ë¼ìš°í„°
â”‚       â”‚   â”œâ”€â”€ sessions.py            # ì„¸ì…˜ ê´€ë¦¬ API
â”‚       â”‚   â””â”€â”€ websocket.py           # WebSocket API
â”‚       â”œâ”€â”€ config/                    # ì„¤ì • ëª¨ë“ˆ
â”‚       â”‚   â””â”€â”€ system.py              # ì‹œìŠ¤í…œ ì„¤ì •
â”‚       â””â”€â”€ octostrator/               # í•µì‹¬ ë¡œì§
â”‚           â”œâ”€â”€ agents/                # ì—ì´ì „íŠ¸
â”‚           â”‚   â”œâ”€â”€ search_agent.py
â”‚           â”‚   â”œâ”€â”€ web_agent.py
â”‚           â”‚   â”œâ”€â”€ contract_agent.py
â”‚           â”‚   â”œâ”€â”€ code_agent.py
â”‚           â”‚   â””â”€â”€ data_agent.py
â”‚           â”œâ”€â”€ checkpointer/          # ì²´í¬í¬ì¸í„°
â”‚           â”‚   â””â”€â”€ postgres_checkpointer.py
â”‚           â”œâ”€â”€ session/               # ì„¸ì…˜ ê´€ë¦¬
â”‚           â”‚   â””â”€â”€ session_manager.py
â”‚           â””â”€â”€ supervisor/            # Supervisor Graph
â”‚               â”œâ”€â”€ graph.py           # ê·¸ë˜í”„ ë¹Œë“œ
â”‚               â”œâ”€â”€ state.py           # ìƒíƒœ ìŠ¤í‚¤ë§ˆ
â”‚               â””â”€â”€ nodes/             # ë…¸ë“œ êµ¬í˜„
â”‚                   â”œâ”€â”€ intent_understanding.py
â”‚                   â”œâ”€â”€ planning.py
â”‚                   â”œâ”€â”€ router.py
â”‚                   â””â”€â”€ aggregator.py
â”œâ”€â”€ manual/                            # ë¬¸ì„œ
â”‚   â”œâ”€â”€ ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_ëª…ì„¸ì„œ_251103.md
â”‚   â”œâ”€â”€ API_ëª…ì„¸ì„œ_251103.md
â”‚   â”œâ”€â”€ ì‹œìŠ¤í…œ_í”Œë¡œìš°ì°¨íŠ¸_251103.md
â”‚   â”œâ”€â”€ ì—ì´ì „íŠ¸_í”Œë¡œìš°ì°¨íŠ¸_251103.md
â”‚   â”œâ”€â”€ ì‚¬ìš©ì_ë©”ë‰´ì–¼_251103.md
â”‚   â””â”€â”€ ê°œë°œì_ê°€ì´ë“œ_251103.md
â”œâ”€â”€ test_phase*.py                     # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”œâ”€â”€ run_server.py                      # ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ pyproject.toml                     # í”„ë¡œì íŠ¸ ì„¤ì •
â”œâ”€â”€ uv.lock                            # ì˜ì¡´ì„± ì ê¸ˆ íŒŒì¼
â””â”€â”€ .env                               # í™˜ê²½ ë³€ìˆ˜
```

---

## ìƒˆ ì—ì´ì „íŠ¸ ì¶”ê°€

ìƒˆë¡œìš´ ì—ì´ì „íŠ¸ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¥´ì„¸ìš”.

### 1. ì—ì´ì „íŠ¸ íŒŒì¼ ìƒì„±

`backend/app/octostrator/agents/` ë””ë ‰í† ë¦¬ì— ìƒˆ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

**ì˜ˆì œ: `email_agent.py`**

```python
"""Email Agent

ì´ë©”ì¼ ë°œì†¡ì„ ë‹´ë‹¹í•˜ëŠ” ì—ì´ì „íŠ¸
"""
from typing import Dict, Any
from langchain_openai import ChatOpenAI
from langchain_core.messages import AIMessage

async def execute_email_agent(state: Dict[str, Any]) -> Dict[str, Any]:
    """Email Agent ì‹¤í–‰

    Args:
        state: í˜„ì¬ ìƒíƒœ

    Returns:
        ì—…ë°ì´íŠ¸ëœ ìƒíƒœ
    """
    # í˜„ì¬ ë‹¨ê³„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    plan = state["plan"]
    current_step = state["current_step"]
    step_info = plan["steps"][current_step]
    task = step_info["task"]

    # LLM ì´ˆê¸°í™”
    llm = ChatOpenAI(model="gpt-4", temperature=0)

    # í”„ë¡¬í”„íŠ¸ êµ¬ì„±
    prompt = f"""
    ë‹¤ìŒ ì´ë©”ì¼ ë°œì†¡ ì‘ì—…ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

    ì‘ì—…: {task}

    ì´ë©”ì¼ ë‚´ìš©ì„ ì‘ì„±í•˜ê³  ë°œì†¡ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.

    ì‘ë‹µ í˜•ì‹:
    - ìˆ˜ì‹ ì: [ì´ë©”ì¼ ì£¼ì†Œ]
    - ì œëª©: [ì´ë©”ì¼ ì œëª©]
    - ë³¸ë¬¸: [ì´ë©”ì¼ ë³¸ë¬¸]
    """

    # LLM í˜¸ì¶œ
    response = await llm.ainvoke(prompt)

    # ë©”ì‹œì§€ ì¶”ê°€
    state["messages"].append(
        AIMessage(content=f"[Email Agent] {response.content}")
    )

    # ë‹¤ìŒ ë‹¨ê³„ë¡œ
    state["current_step"] += 1

    return state
```

### 2. Supervisor Graphì— ì—ì´ì „íŠ¸ ë“±ë¡

`backend/app/octostrator/supervisor/graph.py`ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

```python
from backend.app.octostrator.agents.email_agent import execute_email_agent

def build_supervisor_graph(checkpointer=None):
    # ê¸°ì¡´ ì½”ë“œ...

    # Email Agent ë…¸ë“œ ì¶”ê°€
    graph.add_node("email_agent", execute_email_agent)

    # ë¼ìš°íŒ… ë¡œì§ ìˆ˜ì •
    def route_to_agent(state: SupervisorState) -> str:
        plan = state["plan"]
        current_step = state["current_step"]
        step_info = plan["steps"][current_step]
        agent = step_info["agent"]

        agent_map = {
            "search": "search_agent",
            "web": "web_agent",
            "contract": "contract_agent",
            "code": "code_agent",
            "data": "data_agent",
            "email": "email_agent",  # ì¶”ê°€
        }

        return agent_map.get(agent, "search_agent")

    # ì—£ì§€ ì¶”ê°€
    graph.add_edge("email_agent", "router")

    # ë‚˜ë¨¸ì§€ ì½”ë“œ...
```

### 3. Planning ë…¸ë“œì—ì„œ ì—ì´ì „íŠ¸ ì¸ì‹

`backend/app/octostrator/supervisor/nodes/planning.py`ì˜ í”„ë¡¬í”„íŠ¸ì— ìƒˆ ì—ì´ì „íŠ¸ ì„¤ëª… ì¶”ê°€:

```python
prompt = f"""
...

ì‚¬ìš© ê°€ëŠ¥í•œ ì—ì´ì „íŠ¸:
- search: ì •ë³´ ê²€ìƒ‰
- web: ì›¹ í¬ë¡¤ë§
- contract: ê³„ì•½ì„œ ì‘ì„±
- code: ì½”ë“œ ìƒì„±
- data: ë°ì´í„° ë¶„ì„
- email: ì´ë©”ì¼ ë°œì†¡  # ì¶”ê°€

...
"""
```

### 4. í…ŒìŠ¤íŠ¸ ì‘ì„±

`test_email_agent.py`:

```python
"""Email Agent í…ŒìŠ¤íŠ¸"""
import asyncio
from langchain_core.messages import HumanMessage
from backend.app.octostrator.supervisor.graph import build_supervisor_graph
from backend.app.octostrator.checkpointer import create_checkpointer
from backend.app.octostrator.session import get_session_config

async def test_email_agent():
    checkpointer = await create_checkpointer()
    graph = build_supervisor_graph(checkpointer=checkpointer)
    config = get_session_config("test_email_001")

    result = await graph.ainvoke({
        "messages": [HumanMessage(content="ê³ ê°ì—ê²Œ ê°ì‚¬ ì´ë©”ì¼ì„ ë³´ë‚´ì£¼ì„¸ìš”")],
        "output_format": "chat"
    }, config=config)

    print("âœ“ Email Agent í…ŒìŠ¤íŠ¸ ì™„ë£Œ")
    print(f"ìµœì¢… ì‘ë‹µ: {result['final_result']}")

if __name__ == "__main__":
    asyncio.run(test_email_agent())
```

---

## ì»¤ìŠ¤í…€ ë…¸ë“œ ì‘ì„±

### ë…¸ë“œ êµ¬ì¡°

ëª¨ë“  ë…¸ë“œëŠ” ë‹¤ìŒ ì‹œê·¸ë‹ˆì²˜ë¥¼ ë”°ë¦…ë‹ˆë‹¤:

```python
async def custom_node(state: SupervisorState) -> SupervisorState:
    """ì»¤ìŠ¤í…€ ë…¸ë“œ

    Args:
        state: í˜„ì¬ ìƒíƒœ

    Returns:
        ì—…ë°ì´íŠ¸ëœ ìƒíƒœ
    """
    # 1. ìƒíƒœì—ì„œ í•„ìš”í•œ ì •ë³´ ì¶”ì¶œ
    messages = state["messages"]

    # 2. ì‘ì—… ìˆ˜í–‰ (LLM í˜¸ì¶œ ë“±)
    # ...

    # 3. ìƒíƒœ ì—…ë°ì´íŠ¸
    state["custom_field"] = "value"

    # 4. ë©”ì‹œì§€ ì¶”ê°€
    state["messages"].append(AIMessage(content="..."))

    return state
```

### ì˜ˆì œ: ë°ì´í„° ê²€ì¦ ë…¸ë“œ

```python
"""Data Validation Node

ë°ì´í„° ìœ íš¨ì„± ê²€ì¦ ë…¸ë“œ
"""
from typing import Dict, Any
from langchain_core.messages import AIMessage
from backend.app.octostrator.supervisor.state import SupervisorState

async def validate_data_node(state: SupervisorState) -> SupervisorState:
    """ë°ì´í„° ê²€ì¦ ë…¸ë“œ

    ì‚¬ìš©ì ì…ë ¥ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ ì•Œë¦¼
    """
    messages = state["messages"]
    last_message = messages[-1].content

    # ê°„ë‹¨í•œ ê²€ì¦ ë¡œì§
    errors = []

    if len(last_message) < 5:
        errors.append("ë©”ì‹œì§€ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤")

    if not any(char.isalnum() for char in last_message):
        errors.append("ìœ íš¨í•œ ë¬¸ìê°€ ì—†ìŠµë‹ˆë‹¤")

    # ê²€ì¦ ê²°ê³¼ ë©”ì‹œì§€ ì¶”ê°€
    if errors:
        validation_msg = f"[Validation] ì˜¤ë¥˜ ë°œê²¬: {', '.join(errors)}"
    else:
        validation_msg = "[Validation] ë°ì´í„° ê²€ì¦ í†µê³¼"

    state["messages"].append(AIMessage(content=validation_msg))

    return state
```

### ê·¸ë˜í”„ì— ë…¸ë“œ ì¶”ê°€

```python
# graph.py
from backend.app.octostrator.supervisor.nodes.validate import validate_data_node

def build_supervisor_graph(checkpointer=None):
    graph = StateGraph(SupervisorState)

    # ë…¸ë“œ ì¶”ê°€
    graph.add_node("validate", validate_data_node)
    graph.add_node("intent_understanding", intent_understanding_node)

    # ì—£ì§€ ì¶”ê°€
    graph.set_entry_point("validate")
    graph.add_edge("validate", "intent_understanding")

    # ë‚˜ë¨¸ì§€ ì½”ë“œ...
```

---

## ì„¸ì…˜ ê´€ë¦¬

### thread_idì™€ ì„¸ì…˜

LangGraphì—ì„œ `thread_id`ëŠ” ì„¸ì…˜ì„ ì‹ë³„í•˜ëŠ” í•µì‹¬ ê°œë…ì…ë‹ˆë‹¤.

**ì¤‘ìš” ê°œë…:**
- `thread_id` = `session_id` (ë™ì¼í•œ ì˜ë¯¸)
- ëª¨ë“  ì²´í¬í¬ì¸íŠ¸ëŠ” `thread_id`ë¡œ ê²©ë¦¬ë¨
- ê°™ì€ `thread_id`ë¡œ ì¬ì ‘ì†í•˜ë©´ ì´ì „ ìƒíƒœê°€ ë³µì›ë¨

### SessionManager ì‚¬ìš©

**1. ìë™ ì„¸ì…˜ ìƒì„± (UUID ê¸°ë°˜)**

```python
from backend.app.octostrator.session import create_session, get_session_config

# UUID ê¸°ë°˜ thread_id ìë™ ìƒì„±
thread_id = create_session(user_id="user_123", metadata={"source": "api"})
# ê²°ê³¼: "thread_1a2b3c4d5e6f7g8h"

# Config ìƒì„±
config = get_session_config(thread_id)

# Graph ì‹¤í–‰
result = await graph.ainvoke(initial_input, config=config)
```

**2. ìˆ˜ë™ thread_id ì œê³µ (ìˆœìˆ˜ UUID)**

```python
import uuid
from backend.app.octostrator.session import get_session_config

# ìˆœìˆ˜ UUID ì‚¬ìš©
thread_id = str(uuid.uuid4())
# ê²°ê³¼: "550e8400-e29b-41d4-a716-446655440000"

config = get_session_config(thread_id)

# Graph ì‹¤í–‰
result = await graph.ainvoke(initial_input, config=config)
```

**3. ì»¤ìŠ¤í…€ ë¬¸ìì—´ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)**

```python
from backend.app.octostrator.session import get_session_config

# ê°œë°œ/í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ê°„ë‹¨í•œ ë¬¸ìì—´ ì‚¬ìš© ê°€ëŠ¥
config = get_session_config("my_test_session_001")

result = await graph.ainvoke(initial_input, config=config)
```

### ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬

**ì„¸ì…˜ ì •ë³´ ì¡°íšŒ:**

```python
from backend.app.octostrator.session import get_session_manager

manager = get_session_manager()

# íŠ¹ì • ì„¸ì…˜ ì¡°íšŒ
session = manager.get_session("thread_1a2b3c4d")
print(session["status"])  # active, waiting_human, completed

# ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
sessions = manager.list_sessions(user_id="user_123")

# ìƒíƒœ ì—…ë°ì´íŠ¸
manager.update_session_status("thread_1a2b3c4d", "completed")

# ì„¸ì…˜ ì‚­ì œ
manager.delete_session("thread_1a2b3c4d")
```

### ì²´í¬í¬ì¸íŠ¸ ì¡°íšŒ

**íŠ¹ì • ì„¸ì…˜ì˜ ëª¨ë“  ì²´í¬í¬ì¸íŠ¸ ì¡°íšŒ:**

```python
from backend.app.octostrator.checkpointer import create_checkpointer
from backend.app.octostrator.session import get_session_config

checkpointer = await create_checkpointer()
config = get_session_config("thread_1a2b3c4d")

# ì²´í¬í¬ì¸íŠ¸ ëª©ë¡ ì¡°íšŒ (ìµœì‹ ë¶€í„°)
checkpoint_tuples = checkpointer.alist(config)

async for checkpoint_tuple in checkpoint_tuples:
    checkpoint = checkpoint_tuple.checkpoint
    metadata = checkpoint_tuple.metadata
    print(f"Checkpoint ID: {checkpoint['id']}")
    print(f"Step: {metadata.get('step', 0)}")
```

**íŠ¹ì • ì²´í¬í¬ì¸íŠ¸ë¡œ ë³µì›:**

```python
# ì²´í¬í¬ì¸íŠ¸ IDë¥¼ ì§€ì •í•˜ì—¬ ìƒíƒœ ë³µì›
config_with_checkpoint = {
    "configurable": {
        "thread_id": "thread_1a2b3c4d",
        "checkpoint_id": "1f0b8754-d0c9-63cd-801c-aaa11472b0f5"
    }
}

# í•´ë‹¹ ì‹œì ì˜ ìƒíƒœë¡œ ë³µì›
state = await graph.aget_state(config_with_checkpoint)
print(state.values)
```

### ì„¸ì…˜ ID í˜•ì‹ ê¶Œì¥ì‚¬í•­

**ìš´ì˜ í™˜ê²½:**
```python
import uuid

# UUID ì‚¬ìš© (ê¶Œì¥)
thread_id = str(uuid.uuid4())
```

**ì¥ì :**
- ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•¨ ë³´ì¥
- ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ (ë³´ì•ˆ)
- ì¶©ëŒ ë°©ì§€
- ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ ì•ˆì „

**ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½:**
```python
# ê°„ë‹¨í•œ ë¬¸ìì—´ (í…ŒìŠ¤íŠ¸ìš©)
thread_id = "test_session_001"
```

**ì¥ì :**
- ë””ë²„ê¹… í¸ë¦¬
- ë¡œê·¸ ì¶”ì  ì‰¬ì›€
- ì¬í˜„ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸

### ì£¼ì˜ì‚¬í•­

**1. /chat ì—”ë“œí¬ì¸íŠ¸ì˜ í•œê³„:**

í˜„ì¬ `/chat` POST ì—”ë“œí¬ì¸íŠ¸ëŠ” ì„¸ì…˜ ê´€ë¦¬ë¥¼ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

```python
# backend/app/main.py
@app.post("/chat")
async def chat(request: ChatRequest):
    # âŒ config ì—†ìŒ â†’ ì„¸ì…˜ ì—†ìŒ
    result = await supervisor_graph.ainvoke({
        "messages": [HumanMessage(content=request.message)]
    })
```

ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™”ê°€ í•„ìš”í•˜ë©´ WebSocketì„ ì‚¬ìš©í•˜ì„¸ìš”.

**2. ì„¸ì…˜ ê²©ë¦¬:**

ê° `thread_id`ëŠ” ì™„ì „íˆ ê²©ë¦¬ëœ ìƒíƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤:

```python
# ì„¸ì…˜ A
config_a = get_session_config("session_a")
await graph.ainvoke(input_a, config=config_a)

# ì„¸ì…˜ B (ì™„ì „íˆ ë…ë¦½ì )
config_b = get_session_config("session_b")
await graph.ainvoke(input_b, config=config_b)
```

**3. ë©”ëª¨ë¦¬ ê´€ë¦¬:**

í˜„ì¬ `SessionManager`ëŠ” ë©”ëª¨ë¦¬ ê¸°ë°˜ì…ë‹ˆë‹¤. ì„œë²„ ì¬ì‹œì‘ ì‹œ ì„¸ì…˜ ë©”íƒ€ë°ì´í„°ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì²´í¬í¬ì¸íŠ¸ëŠ” PostgreSQLì— ì €ì¥ë˜ë¯€ë¡œ ë³µì› ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ì¶œë ¥ Generator ì»¤ìŠ¤í„°ë§ˆì´ì§•

ì‹œìŠ¤í…œì€ ì„¸ ê°€ì§€ ì¶œë ¥ Generatorë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê° GeneratorëŠ” ë™ì¼í•œ `aggregated_data`ë¥¼ ë°›ì•„ ë‹¤ë¥¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

### Generator êµ¬ì¡°

ëª¨ë“  GeneratorëŠ” ë‹¤ìŒ ìœ„ì¹˜ì— ìˆìŠµë‹ˆë‹¤:
```
backend/app/octostrator/supervisor/nodes/generators/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ chat_generator.py      # ëŒ€í™”í˜• í…ìŠ¤íŠ¸
â”œâ”€â”€ graph_generator.py     # ê·¸ë˜í”„ ì‹œê°í™” JSON
â””â”€â”€ report_generator.py    # ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ
```

### 1. Chat Generator (`chat_generator.py`)

ëŒ€í™”í˜• í…ìŠ¤íŠ¸ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `backend/app/octostrator/supervisor/nodes/generators/chat_generator.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ì´ëª¨ì§€ í¬í•¨ ìš”ì•½
- ì‹¤í–‰ ë‹¨ê³„ë³„ ê²°ê³¼
- ì£¼ìš” ì¸ì‚¬ì´íŠ¸ í‘œì‹œ

**ì½”ë“œ êµ¬ì¡°**:
```python
async def chat_generator_node(state: SupervisorState) -> Dict:
    """Chat Generator - ëŒ€í™”í˜• í…ìŠ¤íŠ¸ ì‘ë‹µ ìƒì„±

    Args:
        state: aggregated_data í¬í•¨

    Returns:
        Dict: final_resultì— í…ìŠ¤íŠ¸ í¬í•¨
    """
    aggregated_data = state["aggregated_data"]

    # 1. ê¸°ë³¸ ì‘ë‹µ ìƒì„±
    chat_response = f"""{aggregated_data['final_answer']}

---

ğŸ“Š **ì‹¤í–‰ ìš”ì•½**
- ì´ {aggregated_data['execution_summary']['total_steps']}ê°œ ë‹¨ê³„ ì‹¤í–‰
- ì™„ë£Œ: {aggregated_data['execution_summary']['completed_steps']}ê°œ
- ì‹¤íŒ¨: {aggregated_data['execution_summary']['failed_steps']}ê°œ
"""

    # 2. ì¸ì‚¬ì´íŠ¸ ì¶”ê°€
    if aggregated_data["insights"]:
        chat_response += "\n\nğŸ’¡ **ì£¼ìš” ì¸ì‚¬ì´íŠ¸**\n"
        for insight in aggregated_data["insights"][:3]:
            chat_response += f"- {insight['description']}\n"

    return {
        "final_result": chat_response,
        "messages": [AIMessage(content=chat_response)]
    }
```

**ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì‹œ**:
```python
# íŠ¹ì • ê³ ê°ì„ ìœ„í•œ ì»¤ìŠ¤í…€ Chat Generator
async def custom_chat_generator_node(state: SupervisorState) -> Dict:
    aggregated_data = state["aggregated_data"]

    # íšŒì‚¬ ë¸Œëœë”© ì¶”ê°€
    chat_response = f"""
ğŸ¢ **Acme Corp ë¶„ì„ ê²°ê³¼**

{aggregated_data['final_answer']}

---

ğŸ“ˆ **ì„±ê³¼ ì§€í‘œ**
âœ… ì™„ë£Œìœ¨: {aggregated_data['execution_summary']['completed_steps'] / aggregated_data['execution_summary']['total_steps'] * 100:.1f}%
â±ï¸ ì²˜ë¦¬ ì‹œê°„: {aggregated_data['execution_summary']['execution_time']:.2f}ì´ˆ

---

*ë³¸ ê²°ê³¼ëŠ” Acme Corp AI Assistantê°€ ìƒì„±í–ˆìŠµë‹ˆë‹¤.*
"""

    return {
        "final_result": chat_response,
        "messages": [AIMessage(content=chat_response)]
    }
```

---

### 2. Graph Generator (`graph_generator.py`)

ê·¸ë˜í”„ ì‹œê°í™”ë¥¼ ìœ„í•œ JSON ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `backend/app/octostrator/supervisor/nodes/generators/graph_generator.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- nodes/edges êµ¬ì¡° ìƒì„±
- D3.js, Cytoscape.js, React Flow í˜¸í™˜
- ë‹¨ê³„ë³„ ìƒíƒœë¥¼ ì‹œê°ì  ë…¸ë“œë¡œ ë³€í™˜

**ë…¸ë“œ êµ¬ì¡°**:
```json
{
  "id": "step_1",
  "label": "ğŸ” search\në°ì´í„° ê²€ìƒ‰...",
  "type": "search",
  "status": "completed",
  "color": "#4CAF50",
  "metadata": {
    "step_id": 1,
    "agent": "search",
    "description": "ë°ì´í„° ê²€ìƒ‰ ì‘ì—…",
    "result": "ê²€ìƒ‰ ì™„ë£Œ",
    "confidence": 0.95
  }
}
```

**ì—£ì§€ êµ¬ì¡°**:
```json
{
  "id": "edge_step_1_to_step_2",
  "source": "step_1",
  "target": "step_2",
  "label": "",
  "type": "default"
}
```

**ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì‹œ**:
```python
# ê³„ì¸µì  ê·¸ë˜í”„ ìƒì„±
async def hierarchical_graph_generator_node(state: SupervisorState) -> Dict:
    aggregated_data = state["aggregated_data"]

    nodes = []
    edges = []

    # ë‹¨ê³„ë¥¼ Agent íƒ€ì…ë³„ë¡œ ê·¸ë£¹í™”
    agent_groups = {}
    for step in aggregated_data["steps"]:
        agent = step["agent"]
        if agent not in agent_groups:
            agent_groups[agent] = []
        agent_groups[agent].append(step)

    # ê·¸ë£¹ë³„ë¡œ ì„œë¸Œê·¸ë˜í”„ ìƒì„±
    for agent, steps in agent_groups.items():
        # ê·¸ë£¹ ë…¸ë“œ ìƒì„±
        group_node = {
            "id": f"group_{agent}",
            "label": f"{agent.upper()} Tasks",
            "type": "group",
            "color": "#E0E0E0",
            "children": [f"step_{s['step_id']}" for s in steps]
        }
        nodes.append(group_node)

        # ê°œë³„ ë‹¨ê³„ ë…¸ë“œ
        for step in steps:
            nodes.append({
                "id": f"step_{step['step_id']}",
                "label": step['description'],
                "type": step['agent'],
                "parent": f"group_{agent}"  # ê³„ì¸µ êµ¬ì¡°
            })

    return {
        "final_result": {
            "nodes": nodes,
            "edges": edges,
            "layout": "hierarchical"
        },
        "messages": []
    }
```

---

### 3. Report Generator (`report_generator.py`)

êµ¬ì¡°í™”ëœ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `backend/app/octostrator/supervisor/nodes/generators/report_generator.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ë§ˆí¬ë‹¤ìš´ í˜•ì‹
- PDF ë³€í™˜ ê°€ëŠ¥
- ìƒì„¸í•œ ì‹¤í–‰ ë‚´ì—­ í¬í•¨

**ë³´ê³ ì„œ êµ¬ì¡°**:
```markdown
# ë¶„ì„ ë³´ê³ ì„œ

**ìƒì„± ì¼ì‹œ**: 2025-11-03 14:30:00
**ìš”ì²­ ë‚´ìš©**: ë°ì´í„° ë¶„ì„ ìš”ì²­

---

## ğŸ“‹ ìš”ì•½
...

## ğŸ“Š ì‹¤í–‰ í†µê³„
| í•­ëª© | ìˆ˜ì¹˜ |
|------|------|
| ì´ ì‹¤í–‰ ë‹¨ê³„ | 5ê°œ |

## ğŸ” ìƒì„¸ ì‹¤í–‰ ë‚´ì—­
### âœ… Step 1: ê²€ìƒ‰
...

## ğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸
...

## ğŸ“Œ ê²°ë¡ 
...
```

**ì»¤ìŠ¤í„°ë§ˆì´ì§• ì˜ˆì‹œ**:
```python
# ë³´ê³ ì„œì— ì°¨íŠ¸ ë°ì´í„° ì¶”ê°€
async def enhanced_report_generator_node(state: SupervisorState) -> Dict:
    aggregated_data = state["aggregated_data"]

    report = f"""# ğŸ“Š ìƒì„¸ ë¶„ì„ ë³´ê³ ì„œ

**ìƒì„± ì¼ì‹œ**: {datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
**ë¶„ì„ ID**: {state.get('thread_id', 'N/A')}

---

## 1ï¸âƒ£ ìš”ì•½

{aggregated_data['final_answer']}

---

## 2ï¸âƒ£ ì‹¤í–‰ í†µê³„

| í•­ëª© | ìˆ˜ì¹˜ | ë°±ë¶„ìœ¨ |
|------|------|--------|
| ì´ ì‹¤í–‰ ë‹¨ê³„ | {aggregated_data['execution_summary']['total_steps']}ê°œ | 100% |
| ì™„ë£Œëœ ë‹¨ê³„ | {aggregated_data['execution_summary']['completed_steps']}ê°œ | {aggregated_data['execution_summary']['completed_steps'] / aggregated_data['execution_summary']['total_steps'] * 100:.1f}% |
| ì‹¤íŒ¨í•œ ë‹¨ê³„ | {aggregated_data['execution_summary']['failed_steps']}ê°œ | {aggregated_data['execution_summary']['failed_steps'] / aggregated_data['execution_summary']['total_steps'] * 100:.1f}% |

### ğŸ“ˆ ì„±ê³¼ ì°¨íŠ¸ (Mermaid)

```mermaid
pie title ì‹¤í–‰ ê²°ê³¼
    "ì™„ë£Œ" : {aggregated_data['execution_summary']['completed_steps']}
    "ì‹¤íŒ¨" : {aggregated_data['execution_summary']['failed_steps']}
```

---

## 3ï¸âƒ£ íƒ€ì„ë¼ì¸

```mermaid
gantt
    title ì‘ì—… íƒ€ì„ë¼ì¸
    dateFormat HH:mm:ss
"""

    # ê° ë‹¨ê³„ë¥¼ íƒ€ì„ë¼ì¸ì— ì¶”ê°€
    for step in aggregated_data["steps"]:
        report += f"    {step['description']} : done, step{step['step_id']}, 00:00:00, 10s\n"

    report += """```

---

## 4ï¸âƒ£ ìƒì„¸ ë‚´ì—­
"""

    # ë‹¨ê³„ë³„ ìƒì„¸ ë‚´ì—­
    for step in aggregated_data["steps"]:
        report += f"""
### Step {step['step_id']}: {step['description']}

- **Agent**: `{step['agent']}`
- **ìƒíƒœ**: {step['status']}
- **ì‹ ë¢°ë„**: {step.get('confidence', 0.9) * 100:.1f}%

**ê²°ê³¼**:
```
{step.get('result', 'N/A')}
```

---
"""

    report += """
## 5ï¸âƒ£ ê¶Œì¥ ì‚¬í•­

"""

    # ì¸ì‚¬ì´íŠ¸ ì¤‘ recommendationë§Œ ì¶”ì¶œ
    recommendations = [
        i for i in aggregated_data["insights"]
        if i["category"] == "recommendation"
    ]

    for rec in recommendations:
        report += f"- âœ… {rec['description']}\n"

    report += """

---

*ì´ ë³´ê³ ì„œëŠ” Octostrator AI Systemì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
"""

    return {
        "final_result": report,
        "messages": []
    }
```

---

### Router ìˆ˜ì •í•˜ê¸°

ìƒˆë¡œìš´ Generatorë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ë¼ìš°íŒ… ë¡œì§ì„ ë³€ê²½í•˜ë ¤ë©´ `router.py`ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.

**íŒŒì¼ ìœ„ì¹˜**: `backend/app/octostrator/supervisor/nodes/router.py`

**í˜„ì¬ ë¼ìš°íŒ… ë¡œì§**:
```python
async def output_router_node(state: SupervisorState) -> Command:
    output_format = state.get("output_format", "chat")

    if output_format == "chat":
        return Command(goto="chat_generator")
    elif output_format == "graph":
        return Command(goto="graph_generator")
    elif output_format == "report":
        return Command(goto="report_generator")
    else:
        return Command(goto="chat_generator")
```

**ìƒˆ Generator ì¶”ê°€ ì˜ˆì‹œ**:
```python
# 1. ìƒˆ Generator ì‘ì„±
# backend/app/octostrator/supervisor/nodes/generators/json_generator.py
async def json_generator_node(state: SupervisorState) -> Dict:
    """JSON í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ ë°˜í™˜"""
    aggregated_data = state["aggregated_data"]

    json_output = {
        "summary": aggregated_data["final_answer"],
        "steps": aggregated_data["steps"],
        "insights": aggregated_data["insights"],
        "metrics": aggregated_data["execution_summary"]
    }

    return {
        "final_result": json.dumps(json_output, indent=2),
        "messages": []
    }

# 2. Routerì— ì¶”ê°€
async def output_router_node(state: SupervisorState) -> Command:
    output_format = state.get("output_format", "chat")

    if output_format == "chat":
        return Command(goto="chat_generator")
    elif output_format == "graph":
        return Command(goto="graph_generator")
    elif output_format == "report":
        return Command(goto="report_generator")
    elif output_format == "json":  # ìƒˆë¡œ ì¶”ê°€
        return Command(goto="json_generator")
    else:
        return Command(goto="chat_generator")

# 3. Graphì— ë…¸ë“œ ë“±ë¡
# backend/app/octostrator/supervisor/graph.py
from backend.app.octostrator.supervisor.nodes.generators import (
    chat_generator_node,
    graph_generator_node,
    report_generator_node,
    json_generator_node  # ì¶”ê°€
)

def build_supervisor_graph(checkpointer=None):
    # ...
    graph.add_node("json_generator", json_generator_node)
    graph.add_edge("json_generator", END)
```

---

### ë³‘ë ¬ Generator ì‹¤í–‰

ì—¬ëŸ¬ í˜•ì‹ì„ ë™ì‹œì— ìƒì„±í•˜ë ¤ë©´ LangGraphì˜ ë³‘ë ¬ ì‹¤í–‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```python
from langgraph.types import Send, Command

async def parallel_router_node(state: SupervisorState) -> Command:
    """ì—¬ëŸ¬ Generatorë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰"""
    output_format = state.get("output_format", "chat")

    if output_format == "all":
        # 3ê°œ ëª¨ë‘ ë³‘ë ¬ ì‹¤í–‰
        return Command(goto=[
            Send("chat_generator", state),
            Send("graph_generator", state),
            Send("report_generator", state)
        ])
    else:
        # ë‹¨ì¼ Generator ì‹¤í–‰
        return Command(goto=f"{output_format}_generator")

# Aggregator ë…¸ë“œì—ì„œ ê²°ê³¼ ìˆ˜ì§‘
async def result_aggregator_node(state: SupervisorState) -> Dict:
    """ë³‘ë ¬ ì‹¤í–‰ëœ Generator ê²°ê³¼ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹¨"""
    return {
        "final_result": {
            "chat": state.get("chat_result"),
            "graph": state.get("graph_result"),
            "report": state.get("report_result")
        }
    }
```

---

### í…ŒìŠ¤íŠ¸

Generatorë¥¼ í…ŒìŠ¤íŠ¸í•  ë•ŒëŠ” `aggregated_data`ë¥¼ ì§ì ‘ êµ¬ì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

```python
import asyncio
from backend.app.octostrator.supervisor.nodes.generators import chat_generator_node

async def test_chat_generator():
    # Mock aggregated_data
    state = {
        "aggregated_data": {
            "final_answer": "í…ŒìŠ¤íŠ¸ ì‘ë‹µì…ë‹ˆë‹¤.",
            "execution_summary": {
                "total_steps": 3,
                "completed_steps": 3,
                "failed_steps": 0,
                "hitl_interactions": 0,
                "execution_time": 5.2
            },
            "insights": [
                {
                    "category": "recommendation",
                    "description": "ë‹¤ìŒì—ëŠ” ë” ë¹ ë¥¸ ë°©ë²•ì„ ì‚¬ìš©í•˜ì„¸ìš”",
                    "importance": 0.8
                }
            ],
            "steps": []
        }
    }

    result = await chat_generator_node(state)
    print("Chat Generator ê²°ê³¼:")
    print(result["final_result"])

asyncio.run(test_chat_generator())
```

---

## í…ŒìŠ¤íŠ¸ ì‘ì„±

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

`tests/test_intent_understanding.py`:

```python
"""Intent Understanding ë…¸ë“œ í…ŒìŠ¤íŠ¸"""
import pytest
from langchain_core.messages import HumanMessage, AIMessage
from backend.app.octostrator.supervisor.nodes.intent_understanding import (
    intent_understanding_node
)

@pytest.mark.asyncio
async def test_intent_understanding():
    """Intent Understanding ê¸°ë³¸ í…ŒìŠ¤íŠ¸"""
    state = {
        "messages": [HumanMessage(content="ê³„ì•½ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”")],
        "user_intent": None,
        "output_format": "chat"
    }

    result = await intent_understanding_node(state)

    assert result["user_intent"] is not None
    assert result["user_intent"]["category"] == "contract"
    assert len(result["messages"]) == 2

@pytest.mark.asyncio
async def test_intent_search():
    """ê²€ìƒ‰ ì˜ë„ ë¶„ë¥˜ í…ŒìŠ¤íŠ¸"""
    state = {
        "messages": [HumanMessage(content="íŒŒì´ì¬ì— ëŒ€í•´ ì•Œë ¤ì£¼ì„¸ìš”")],
        "user_intent": None,
        "output_format": "chat"
    }

    result = await intent_understanding_node(state)

    assert result["user_intent"]["category"] == "search"
```

### í†µí•© í…ŒìŠ¤íŠ¸

`tests/test_integration.py`:

```python
"""í†µí•© í…ŒìŠ¤íŠ¸"""
import pytest
import asyncio
from langchain_core.messages import HumanMessage
from backend.app.octostrator.supervisor.graph import build_supervisor_graph
from backend.app.octostrator.checkpointer import create_checkpointer
from backend.app.octostrator.session import get_session_config

@pytest.mark.asyncio
async def test_full_workflow():
    """ì „ì²´ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""
    checkpointer = await create_checkpointer()
    graph = build_supervisor_graph(checkpointer=checkpointer)
    config = get_session_config("test_integration_001")

    result = await graph.ainvoke({
        "messages": [HumanMessage(content="ì•ˆë…•í•˜ì„¸ìš”")],
        "output_format": "chat"
    }, config=config)

    assert "final_result" in result
    assert result["final_result"] is not None
    assert len(result["messages"]) > 1
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
uv run pytest

# íŠ¹ì • í…ŒìŠ¤íŠ¸
uv run pytest tests/test_intent_understanding.py

# íŠ¹ì • í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
uv run pytest tests/test_intent_understanding.py::test_intent_understanding

# ì»¤ë²„ë¦¬ì§€
uv run pytest --cov=backend
```

---

## ë””ë²„ê¹…

### ë¡œê¹… í™œì„±í™”

`backend/app/config/system.py`:

```python
import logging

# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.DEBUG if config.system_debug else logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

logger = logging.getLogger(__name__)
```

### ë…¸ë“œì—ì„œ ë¡œê¹… ì‚¬ìš©

```python
import logging

logger = logging.getLogger(__name__)

async def custom_node(state: SupervisorState) -> SupervisorState:
    logger.debug(f"ë…¸ë“œ ì‹œì‘: current_step={state['current_step']}")

    # ì‘ì—… ìˆ˜í–‰
    logger.info("ì‘ì—… ì™„ë£Œ")

    return state
```

### Checkpoint ë””ë²„ê¹…

```python
# íŠ¹ì • ì„¸ì…˜ì˜ ëª¨ë“  ì²´í¬í¬ì¸íŠ¸ ì¡°íšŒ
async def debug_checkpoints(thread_id: str):
    checkpointer = await create_checkpointer()
    graph = build_supervisor_graph(checkpointer=checkpointer)
    config = get_session_config(thread_id)

    async for checkpoint in checkpointer.alist(config):
        print(f"Checkpoint ID: {checkpoint.config['configurable']['checkpoint_id']}")
        print(f"State: {checkpoint.checkpoint['channel_values']}")
        print("---")
```

### LangSmith ì¶”ì 

LangSmithë¥¼ ì‚¬ìš©í•˜ë©´ LLM í˜¸ì¶œì„ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# .envì— ì¶”ê°€
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=your-langsmith-api-key
LANGCHAIN_PROJECT=octo-worker
```

---

## ë°°í¬

### í”„ë¡œë•ì…˜ ì„¤ì •

#### 1. í™˜ê²½ ë³€ìˆ˜

`.env.production`:

```bash
# OpenAI API
OPENAI_API_KEY=sk-...

# PostgreSQL (í”„ë¡œë•ì…˜ DB)
POSTGRES_URL=postgresql://user:pass@prod-db:5432/octo_chatbot

# System
SYSTEM_DEBUG=False
SYSTEM_API_HOST=0.0.0.0
SYSTEM_API_PORT=8000

# CORS
SYSTEM_ALLOWED_ORIGINS=https://yourdomain.com

# LangSmith (ì„ íƒì‚¬í•­)
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=...
LANGCHAIN_PROJECT=octo-worker-prod
```

#### 2. Docker ë°°í¬

`Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# ì‹œìŠ¤í…œ ì˜ì¡´ì„±
RUN apt-get update && apt-get install -y \
    postgresql-client \
    && rm -rf /var/lib/apt/lists/*

# Python ì˜ì¡´ì„±
COPY pyproject.toml uv.lock ./
RUN pip install uv && uv sync --frozen

# ì½”ë“œ ë³µì‚¬
COPY . .

# ì„œë²„ ì‹¤í–‰
CMD ["uv", "run", "python", "run_server.py"]
```

`docker-compose.yml`:

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: octo_chatbot
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  app:
    build: .
    env_file:
      - .env.production
    ports:
      - "8000:8000"
    depends_on:
      - postgres

volumes:
  postgres_data:
```

#### 3. ë°°í¬ ëª…ë ¹

```bash
# Docker Composeë¡œ ë°°í¬
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f app

# ì¤‘ì§€
docker-compose down
```

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ì—°ê²° í’€ë§

PostgreSQL ì—°ê²° í’€ ì„¤ì •:

```python
# postgres_checkpointer.py
async def create_checkpointer(conn_string: str = None, pool_size: int = 10):
    """Checkpointer ìƒì„± with connection pooling"""
    # ì—°ê²° í’€ í¬ê¸° ì„¤ì •
    checkpointer = AsyncPostgresSaver.from_conn_string(
        conn_string,
        pool_size=pool_size,
        max_overflow=20
    )
    await checkpointer.setup()
    return checkpointer
```

### 2. ìºì‹±

LLM ì‘ë‹µ ìºì‹±:

```python
from langchain.cache import InMemoryCache
from langchain.globals import set_llm_cache

# ìºì‹œ í™œì„±í™”
set_llm_cache(InMemoryCache())
```

### 3. ë¹„ë™ê¸° ì²˜ë¦¬

ëª¨ë“  I/O ì‘ì—…ì„ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬:

```python
# ë¹„ë™ê¸° í•¨ìˆ˜ ì‚¬ìš©
result = await llm.ainvoke(prompt)

# ë³‘ë ¬ ì²˜ë¦¬
results = await asyncio.gather(
    task1(),
    task2(),
    task3()
)
```

---

## ì°¸ì¡°

- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ëª…ì„¸ì„œ](./ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_ëª…ì„¸ì„œ_251103.md)
- [API ëª…ì„¸ì„œ](./API_ëª…ì„¸ì„œ_251103.md)
- [ì—ì´ì „íŠ¸ í”Œë¡œìš°ì°¨íŠ¸](./ì—ì´ì „íŠ¸_í”Œë¡œìš°ì°¨íŠ¸_251103.md)
- [LangGraph ê³µì‹ ë¬¸ì„œ](https://python.langchain.com/docs/langgraph)
- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)
