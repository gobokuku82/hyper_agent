# API ëª…ì„¸ì„œ

**ì‘ì„±ì¼**: 2025-11-03
**ë²„ì „**: 0.4.0
**Base URL**: `http://localhost:8000`

---

## ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì¸ì¦](#ì¸ì¦)
3. [REST API](#rest-api)
4. [WebSocket API](#websocket-api)
5. [ì—ëŸ¬ ì½”ë“œ](#ì—ëŸ¬-ì½”ë“œ)
6. [ì˜ˆì œ](#ì˜ˆì œ)

---

## ê°œìš”

Octo WorkerëŠ” RESTful APIì™€ WebSocket APIë¥¼ ì œê³µí•˜ì—¬ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ì±—ë´‡ê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### API íƒ€ì…

| íƒ€ì… | ìš©ë„ | í”„ë¡œí† ì½œ |
|------|------|---------|
| REST API | ì„¸ì…˜ ê´€ë¦¬, ìƒíƒœ ì¡°íšŒ | HTTP/HTTPS |
| WebSocket API | ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ëŒ€í™” | WebSocket |

---

## ì¸ì¦

í˜„ì¬ ë²„ì „ì—ì„œëŠ” ì¸ì¦ì„ ìš”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í–¥í›„ ë²„ì „ì—ì„œ API Key ê¸°ë°˜ ì¸ì¦ì´ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.

---

## ì„¸ì…˜ ID (thread_id) ê·œì¹™

ëª¨ë“  ì„¸ì…˜ ê´€ë ¨ APIëŠ” `thread_id`ë¥¼ ì„¸ì…˜ ì‹ë³„ìë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### ì§€ì›ë˜ëŠ” í˜•ì‹

**1. UUID (ê¶Œì¥ - ìš´ì˜ í™˜ê²½)**
```
550e8400-e29b-41d4-a716-446655440000
```
- ì „ì—­ì ìœ¼ë¡œ ê³ ìœ 
- ë³´ì•ˆì— ìœ ë¦¬ (ì˜ˆì¸¡ ë¶ˆê°€)
- ì¶©ëŒ ì—†ìŒ

**2. ìë™ ìƒì„± í˜•ì‹**
```
thread_1a2b3c4d5e6f7g8h
```
- `SessionManager.create_session()` ìë™ ìƒì„±
- `thread_` + UUID ì• 16ì

**3. ì»¤ìŠ¤í…€ ë¬¸ìì—´ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)**
```
my_session_001
test_session_123
```
- ê°œë°œ í¸ì˜ì„±
- ë¡œê·¸ ì¶”ì  ìš©ì´
- **ìš´ì˜ í™˜ê²½ ë¹„ê¶Œì¥**

### ì‚¬ìš© ì˜ˆì œ

**WebSocket ì—°ê²°:**
```
ws://localhost:8000/ws/chat/550e8400-e29b-41d4-a716-446655440000
```

**REST API:**
```
GET /api/sessions/550e8400-e29b-41d4-a716-446655440000
```

### ì¤‘ìš” ê°œë…

- `thread_id` = `session_id` (ë™ì¼í•œ ì˜ë¯¸)
- ê°™ì€ `thread_id`ë¡œ ì¬ì ‘ì† ì‹œ ì´ì „ ëŒ€í™” ë³µì›
- ê° `thread_id`ëŠ” ì™„ì „íˆ ê²©ë¦¬ëœ ìƒíƒœ ìœ ì§€
- PostgreSQLì— ì²´í¬í¬ì¸íŠ¸ë¡œ ì˜êµ¬ ì €ì¥

---

## REST API

### ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸

#### 1. í—¬ìŠ¤ ì²´í¬

```http
GET /
```

**ì„¤ëª…**: ì„œë²„ ìƒíƒœ í™•ì¸

**ì‘ë‹µ**:
```json
{
  "message": "LangGraph Chatbot API",
  "version": "0.4.0",
  "status": "running"
}
```

---

#### 2. í—¬ìŠ¤ ì²´í¬ (ìƒì„¸)

```http
GET /health
```

**ì„¤ëª…**: ì„œë²„ í—¬ìŠ¤ ìƒíƒœ í™•ì¸

**ì‘ë‹µ**:
```json
{
  "status": "healthy"
}
```

---

### ì±„íŒ… API

#### 3. ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ë™ê¸°)

```http
POST /chat
Content-Type: application/json
```

**ì„¤ëª…**: ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ ë° ì‘ë‹µ ìˆ˜ì‹ 

**Request Body**:
```json
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”, ê°„ë‹¨í•œ ê³„ì•½ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
}
```

**Response**:
```json
{
  "response": "[ìµœì¢… ì‘ë‹µ] ê³„ì•½ì„œê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤..."
}
```

**ì—ëŸ¬ ì‘ë‹µ**:
```json
{
  "detail": "Error processing chat: ..."
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `500 Internal Server Error`: ì²˜ë¦¬ ì¤‘ ì—ëŸ¬

**âš ï¸ ì¤‘ìš” ì œí•œì‚¬í•­**:
- ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” **stateless**ì…ë‹ˆë‹¤ (ì„¸ì…˜ ì—†ìŒ)
- ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ê°€ ìœ ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
- HITLì´ ë°œìƒí•˜ë©´ ì¤‘ë‹¨ë©ë‹ˆë‹¤
- **ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™”ê°€ í•„ìš”í•˜ë©´ WebSocket APIë¥¼ ì‚¬ìš©í•˜ì„¸ìš”**

---

### ì„¸ì…˜ ê´€ë¦¬ API

#### 4. ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ

```http
GET /api/sessions
```

**ì„¤ëª…**: ëª¨ë“  ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ

**Query Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|---------|------|------|------|
| user_id | string | No | íŠ¹ì • ì‚¬ìš©ìì˜ ì„¸ì…˜ë§Œ ì¡°íšŒ |
| status | string | No | íŠ¹ì • ìƒíƒœì˜ ì„¸ì…˜ë§Œ ì¡°íšŒ |

**ì‘ë‹µ**:
```json
{
  "sessions": [
    {
      "thread_id": "session_001",
      "user_id": "user_123",
      "status": "active",
      "created_at": "2025-11-03T10:00:00Z",
      "updated_at": "2025-11-03T10:30:00Z"
    }
  ],
  "total": 1
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ

---

#### 5. ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ

```http
GET /api/sessions/{thread_id}
```

**ì„¤ëª…**: íŠ¹ì • ì„¸ì…˜ì˜ í˜„ì¬ ìƒíƒœ ì¡°íšŒ

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| thread_id | string | ì„¸ì…˜ ID (UUID ê¶Œì¥, ì˜ˆ: `550e8400-e29b-41d4-a716-446655440000`) |

**ì‘ë‹µ**:
```json
{
  "thread_id": "session_001",
  "status": "completed",
  "state": {
    "messages": [...],
    "user_intent": {...},
    "plan": {...},
    "current_step": 3,
    "is_planning": false,
    "is_executing": false,
    "final_result": "ì‘ì—… ì™„ë£Œ"
  },
  "checkpoint_id": "1f0b8754-d0c9-63cd-801c-aaa11472b0f5"
}
```

**ìƒíƒœ ê°’**:
- `waiting_human`: HITL ëŒ€ê¸° ì¤‘
- `in_progress`: ì‹¤í–‰ ì¤‘
- `completed`: ì™„ë£Œë¨

**ì—ëŸ¬ ì‘ë‹µ**:
```json
{
  "detail": "Session not found: session_001"
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `404 Not Found`: ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
- `500 Internal Server Error`: ì„œë²„ ì—ëŸ¬

---

#### 6. ì„¸ì…˜ ì‚­ì œ

```http
DELETE /api/sessions/{thread_id}
```

**ì„¤ëª…**: ì„¸ì…˜ ì‚­ì œ

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| thread_id | string | ì„¸ì…˜ ID (UUID ê¶Œì¥) |

**ì‘ë‹µ**:
```json
{
  "message": "Session session_001 deleted successfully"
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `404 Not Found`: ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

---

### HITL (Human-in-the-Loop) API

#### 7. HITL ì„¸ì…˜ ì¬ê°œ

```http
POST /api/sessions/{thread_id}/resume
Content-Type: application/json
```

**ì„¤ëª…**: interruptëœ ì„¸ì…˜ì„ ì¬ê°œ

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| thread_id | string | ì„¸ì…˜ ID (UUID ê¶Œì¥) |

**Request Body**:
```json
{
  "approve": true
}
```

ë˜ëŠ”

```json
{
  "response": "ê³„ì•½ì„œ ë‚´ìš©ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”: ..."
}
```

**í•„ë“œ ì„¤ëª…**:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|------|------|------|------|
| approve | boolean | No | trueë©´ ìë™ ìŠ¹ì¸ (None ì „ë‹¬) |
| response | string | No | ì‚¬ìš©ì í”¼ë“œë°± í…ìŠ¤íŠ¸ |

**ì‘ë‹µ**:
```json
{
  "success": true,
  "message": "Session resumed with auto-approval",
  "state": {...}
}
```

**ì—ëŸ¬ ì‘ë‹µ**:
```json
{
  "detail": "Session is not waiting for human input"
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `400 Bad Request`: ì„¸ì…˜ì´ HITL ëŒ€ê¸° ì¤‘ì´ ì•„ë‹˜
- `404 Not Found`: ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
- `500 Internal Server Error`: ì„œë²„ ì—ëŸ¬

---

### ì²´í¬í¬ì¸íŠ¸ API

#### 8. ì²´í¬í¬ì¸íŠ¸ ëª©ë¡ ì¡°íšŒ

```http
GET /api/sessions/{thread_id}/checkpoints
```

**ì„¤ëª…**: ì„¸ì…˜ì˜ ëª¨ë“  ì²´í¬í¬ì¸íŠ¸ ì¡°íšŒ

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| thread_id | string | ì„¸ì…˜ ID (UUID ê¶Œì¥) |

**ì‘ë‹µ**:
```json
{
  "checkpoints": [
    {
      "checkpoint_id": "1f0b8755-c593-66...",
      "thread_id": "session_001",
      "checkpoint_ns": "",
      "step": 0
    },
    {
      "checkpoint_id": "1f0b8755-c590-6f...",
      "thread_id": "session_001",
      "checkpoint_ns": "",
      "step": 1
    }
  ],
  "total": 30
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `500 Internal Server Error`: ì„œë²„ ì—ëŸ¬

---

#### 9. ì„¸ì…˜ íˆìŠ¤í† ë¦¬ ì¡°íšŒ

```http
GET /api/sessions/{thread_id}/history?limit=10
```

**ì„¤ëª…**: ì„¸ì…˜ì˜ ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ ì¡°íšŒ

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| thread_id | string | ì„¸ì…˜ ID (UUID ê¶Œì¥) |

**Query Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ê¸°ë³¸ê°’ | ì„¤ëª… |
|---------|------|-------|------|
| limit | integer | 10 | ì¡°íšŒí•  ë©”ì‹œì§€ ìˆ˜ (ìµœëŒ€ 100) |

**ì‘ë‹µ**:
```json
{
  "thread_id": "session_001",
  "total_messages": 18,
  "returned_messages": 10,
  "messages": [
    {
      "type": "HumanMessage",
      "content": "ì•ˆë…•í•˜ì„¸ìš”"
    },
    {
      "type": "AIMessage",
      "content": "[Intent Understanding] ì‚¬ìš©ì ìš”ì²­ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤..."
    }
  ]
}
```

**ìƒíƒœ ì½”ë“œ**:
- `200 OK`: ì„±ê³µ
- `404 Not Found`: ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
- `500 Internal Server Error`: ì„œë²„ ì—ëŸ¬

---

## WebSocket API

### WebSocket ì—°ê²°

```
WS /ws/{session_id}
```

**ì„¤ëª…**: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ… ì—°ê²°

**Path Parameters**:
| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| session_id | string | ì„¸ì…˜ ID (thread_idì™€ ë™ì¼) |

**ì„¸ì…˜ ID í˜•ì‹**:
- **UUID** (ê¶Œì¥): `550e8400-e29b-41d4-a716-446655440000`
- **ì»¤ìŠ¤í…€**: `my_session_001` (í…ŒìŠ¤íŠ¸ìš©)

**ë™ì‘ ë°©ì‹**:
- ì‹ ê·œ session_id: ìƒˆ ì„¸ì…˜ ìƒì„±
- ê¸°ì¡´ session_id: ì´ì „ ëŒ€í™” ë³µì›
- ê°™ì€ session_idë¡œ ì¬ì ‘ì† ì‹œ ì²´í¬í¬ì¸íŠ¸ì—ì„œ ìƒíƒœ ë³µì›

**ì˜ˆì œ**:
```
ws://localhost:8000/ws/chat/550e8400-e29b-41d4-a716-446655440000
```

---

### ë©”ì‹œì§€ í”„ë¡œí† ì½œ

#### í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„

**ë©”ì‹œì§€ ì „ì†¡**:
```json
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”, 2023ë…„ ë§¤ì¶œ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”",
  "output_format": "chat"
}
```

**í•„ë“œ ì„¤ëª…**:
| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|------|------|--------|------|
| message | string | âœ… | - | ì‚¬ìš©ì ë©”ì‹œì§€ |
| output_format | string | âŒ | "chat" | ì¶œë ¥ í˜•ì‹ (chat/graph/report) |

**output_format ì˜µì…˜**:
1. **`"chat"`** (ê¸°ë³¸ê°’): ëŒ€í™”í˜• í…ìŠ¤íŠ¸ ì‘ë‹µ
   - ì´ëª¨ì§€ í¬í•¨ ìš”ì•½
   - ì‹¤í–‰ ë‹¨ê³„ + ì¸ì‚¬ì´íŠ¸
   - ì¼ë°˜ ì±„íŒ… UIì— ì í•©

2. **`"graph"`**: ê·¸ë˜í”„ ì‹œê°í™” JSON
   - nodes/edges êµ¬ì¡°
   - D3.js, Cytoscape.js ë Œë”ë§ìš©
   - í”Œë¡œìš° ì°¨íŠ¸ UIì— ì í•©

3. **`"report"`**: ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ
   - êµ¬ì¡°í™”ëœ ë¬¸ì„œ
   - PDF ë³€í™˜ ê°€ëŠ¥
   - ë¬¸ì„œ ë·°ì–´ì— ì í•©

**ì˜ˆì œ**:

```json
// 1. ì¼ë°˜ ëŒ€í™” (ê¸°ë³¸)
{
  "message": "ì•ˆë…•í•˜ì„¸ìš”"
}

// 2. ê·¸ë˜í”„ ì‹œê°í™”
{
  "message": "í”„ë¡œì íŠ¸ ì§„í–‰ ìƒí™©ì„ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì¤˜",
  "output_format": "graph"
}

// 3. ë³´ê³ ì„œ ìƒì„±
{
  "message": "ì›”ê°„ ë¶„ì„ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì¤˜",
  "output_format": "report"
}
```

---

**HITL ì‘ë‹µ** (interrupt ë°œìƒ ì‹œ):
```json
{
  "type": "human_response",
  "approve": true
}
```

ë˜ëŠ”

```json
{
  "type": "human_response",
  "response": "ìˆ˜ì •ì‚¬í•­: ..."
}
```

---

#### ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸

**ì´ë²¤íŠ¸ íƒ€ì…**:

1. **ì—°ê²° í™•ì¸**
```json
{
  "type": "connection",
  "session_id": "session_001",
  "message": "WebSocket ì—°ê²°ë¨"
}
```

2. **ë…¸ë“œ ì‹œì‘**
```json
{
  "event": "on_chain_start",
  "node": "intent_understanding",
  "data": "Intent Understanding ì‹œì‘..."
}
```

3. **ë…¸ë“œ ì™„ë£Œ**
```json
{
  "event": "on_chain_end",
  "node": "planning",
  "data": {
    "plan": {...}
  }
}
```

4. **HITL ìš”ì²­**
```json
{
  "type": "hitl_request",
  "message": "ê³„ì•½ì„œ ì‘ì„±ì„ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
  "context": {...}
}
```

5. **ìµœì¢… ì‘ë‹µ** (output_formatì— ë”°ë¼ ë‹¤ë¦„)

**`output_format: "chat"`** (ê¸°ë³¸ê°’):
```json
{
  "type": "final",
  "output_format": "chat",
  "content": "ğŸ“Š ì‹¤í–‰ ìš”ì•½\n- ì´ 3ê°œ ë‹¨ê³„ ì‹¤í–‰\n- ì™„ë£Œ: 3ê°œ\n\nğŸ’¡ ì£¼ìš” ì¸ì‚¬ì´íŠ¸\nğŸ“ˆ ë§¤ì¶œì´ ì „ì›” ëŒ€ë¹„ 15% ì¦ê°€..."
}
```

**`output_format: "graph"`**:
```json
{
  "type": "final",
  "output_format": "graph",
  "content": {
    "nodes": [
      {
        "id": "step_1",
        "label": "ğŸ” search\në°ì´í„° ê²€ìƒ‰...",
        "type": "search",
        "status": "completed",
        "color": "#4CAF50"
      }
    ],
    "edges": [
      {
        "id": "edge_start_to_step_1",
        "source": "start",
        "target": "step_1"
      }
    ],
    "metadata": {
      "total_steps": 3,
      "completed": 3
    }
  }
}
```

**`output_format: "report"`**:
```json
{
  "type": "final",
  "output_format": "report",
  "content": "# ë¶„ì„ ë³´ê³ ì„œ\n\n**ìƒì„± ì¼ì‹œ**: 2025-11-03 16:00:00\n\n## ğŸ“‹ ìš”ì•½\n\në§¤ì¶œ ë°ì´í„° ë¶„ì„ ê²°ê³¼...\n\n## ğŸ“Š ì‹¤í–‰ í†µê³„\n\n| í•­ëª© | ìˆ˜ì¹˜ |\n|------|------|\n| ì´ ì‹¤í–‰ ë‹¨ê³„ | 3ê°œ |..."
}
```

6. **ì—ëŸ¬**
```json
{
  "type": "error",
  "error": "ì²˜ë¦¬ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ..."
}
```

---

### WebSocket ì—°ê²° ì˜ˆì œ (JavaScript)

```javascript
const sessionId = crypto.randomUUID();  // UUID ìƒì„±
const ws = new WebSocket(`ws://localhost:8000/ws/chat/${sessionId}`);

ws.onopen = () => {
  console.log('WebSocket ì—°ê²°ë¨');

  // 1. ì¼ë°˜ ëŒ€í™” (ê¸°ë³¸)
  ws.send(JSON.stringify({
    message: 'ì•ˆë…•í•˜ì„¸ìš”'
  }));

  // 2. ê·¸ë˜í”„ í˜•ì‹ ìš”ì²­
  ws.send(JSON.stringify({
    message: '2023ë…„ ë§¤ì¶œ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”',
    output_format: 'graph'
  }));

  // 3. ë³´ê³ ì„œ í˜•ì‹ ìš”ì²­
  ws.send(JSON.stringify({
    message: 'ì›”ê°„ ë¶„ì„ ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”',
    output_format: 'report'
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  console.log('ë°›ì€ ë©”ì‹œì§€:', data);

  if (data.type === 'final') {
    if (data.output_format === 'chat') {
      // í…ìŠ¤íŠ¸ ë Œë”ë§
      console.log(data.content);
    } else if (data.output_format === 'graph') {
      // ê·¸ë˜í”„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì‹œê°í™”
      renderGraph(data.content.nodes, data.content.edges);
    } else if (data.output_format === 'report') {
      // ë§ˆí¬ë‹¤ìš´ ë Œë”ë§
      renderMarkdown(data.content);
    }
  }

  // HITL ìš”ì²­ ì²˜ë¦¬
  if (data.type === 'hitl_request') {
    // ì‚¬ìš©ì í™•ì¸ í›„ ìŠ¹ì¸
    ws.send(JSON.stringify({
      type: 'human_response',
      approve: true
    }));
  }
};

ws.onerror = (error) => {
  console.error('WebSocket ì—ëŸ¬:', error);
};

ws.onclose = () => {
  console.log('WebSocket ì—°ê²° ì¢…ë£Œ');
};
```

---

### WebSocket ì—°ê²° ì˜ˆì œ (Python)

```python
import asyncio
import websockets
import json

async def chat():
    uri = "ws://localhost:8000/ws/my_session_001"

    async with websockets.connect(uri) as websocket:
        # ë©”ì‹œì§€ ì „ì†¡
        await websocket.send(json.dumps({
            "type": "message",
            "content": "ì•ˆë…•í•˜ì„¸ìš”"
        }))

        # ì‘ë‹µ ìˆ˜ì‹ 
        async for message in websocket:
            data = json.loads(message)
            print(f"ë°›ì€ ë©”ì‹œì§€: {data}")

            # HITL ì²˜ë¦¬
            if data.get("type") == "hitl_request":
                await websocket.send(json.dumps({
                    "type": "human_response",
                    "approve": True
                }))

asyncio.run(chat())
```

---

## ì—ëŸ¬ ì½”ë“œ

### HTTP ìƒíƒœ ì½”ë“œ

| ìƒíƒœ ì½”ë“œ | ì„¤ëª… |
|----------|------|
| 200 OK | ìš”ì²­ ì„±ê³µ |
| 400 Bad Request | ì˜ëª»ëœ ìš”ì²­ (íŒŒë¼ë¯¸í„° ì˜¤ë¥˜ ë“±) |
| 404 Not Found | ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ |
| 500 Internal Server Error | ì„œë²„ ë‚´ë¶€ ì—ëŸ¬ |

### ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

```json
{
  "detail": "ì—ëŸ¬ ë©”ì‹œì§€"
}
```

---

## ì˜ˆì œ

### ì˜ˆì œ 1: REST APIë¡œ ì„¸ì…˜ ìƒì„± ë° ì¡°íšŒ

```bash
# 1. ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ì•ˆë…•í•˜ì„¸ìš”"}'

# 2. ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
curl http://localhost:8000/api/sessions

# 3. íŠ¹ì • ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ
curl http://localhost:8000/api/sessions/session_001

# 4. ì„¸ì…˜ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
curl http://localhost:8000/api/sessions/session_001/history?limit=5
```

---

### ì˜ˆì œ 2: HITL ì›Œí¬í”Œë¡œìš°

```bash
# 1. HITLì´ í•„ìš”í•œ ì‘ì—… ìš”ì²­ (WebSocket ë˜ëŠ” REST)
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ê³„ì•½ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"}'

# 2. ì„¸ì…˜ ìƒíƒœ í™•ì¸ (waiting_human ìƒíƒœ)
curl http://localhost:8000/api/sessions/contract_session_001

# 3. ì„¸ì…˜ ì¬ê°œ (ìŠ¹ì¸)
curl -X POST http://localhost:8000/api/sessions/contract_session_001/resume \
  -H "Content-Type: application/json" \
  -d '{"approve": true}'

# ë˜ëŠ” í”¼ë“œë°±ê³¼ í•¨ê»˜ ì¬ê°œ
curl -X POST http://localhost:8000/api/sessions/contract_session_001/resume \
  -H "Content-Type: application/json" \
  -d '{"response": "ê³„ì•½ ê¸ˆì•¡ì„ 1000ë§Œì›ìœ¼ë¡œ ìˆ˜ì •í•´ì£¼ì„¸ìš”"}'
```

---

### ì˜ˆì œ 3: WebSocket ì‹¤ì‹œê°„ ëŒ€í™”

```python
import asyncio
import websockets
import json

async def interactive_chat():
    uri = "ws://localhost:8000/ws/interactive_session_001"

    async with websockets.connect(uri) as ws:
        print("ì—°ê²°ë¨")

        # ë©”ì‹œì§€ ì „ì†¡
        await ws.send(json.dumps({
            "type": "message",
            "content": "ê°„ë‹¨í•œ ê³„ì•½ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
        }))

        # ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ìˆ˜ì‹ 
        async for message in ws:
            data = json.loads(message)

            if data.get("type") == "connection":
                print(f"ì„¸ì…˜ ID: {data['session_id']}")

            elif data.get("event") == "on_chain_start":
                print(f"â–¶ {data['node']} ì‹œì‘")

            elif data.get("event") == "on_chain_end":
                print(f"âœ“ {data['node']} ì™„ë£Œ")

            elif data.get("type") == "hitl_request":
                print(f"\n[ìŠ¹ì¸ ìš”ì²­] {data['message']}")
                user_input = input("ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ")

                await ws.send(json.dumps({
                    "type": "human_response",
                    "approve": user_input.lower() == 'y'
                }))

            elif data.get("type") == "final":
                print(f"\n[ìµœì¢… ì‘ë‹µ]\n{data['content']}")
                break

            elif data.get("type") == "error":
                print(f"ì—ëŸ¬: {data['error']}")
                break

asyncio.run(interactive_chat())
```

---

## ì°¸ì¡°

- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ëª…ì„¸ì„œ](./ì‹œìŠ¤í…œ_ì•„í‚¤í…ì²˜_ëª…ì„¸ì„œ_251103.md)
- [ì‚¬ìš©ì ë©”ë‰´ì–¼](./ì‚¬ìš©ì_ë©”ë‰´ì–¼_251103.md)
- [ê°œë°œì ê°€ì´ë“œ](./ê°œë°œì_ê°€ì´ë“œ_251103.md)

---

## Swagger UI

FastAPIì˜ ìë™ ìƒì„± API ë¬¸ì„œëŠ” ë‹¤ìŒ URLì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
